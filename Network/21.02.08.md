# EIGRP

### EIGRP의 개요와 특징

1. CISCO사에서 만든 Distance Vector Routing Protocol 이다.
2. Split Horizon 및 Major Network Boundary에서 자동축약 된다.
3. 라우팅 정보 전송을 위해 IP 프로토콜 번호 88번을 사용한다.
4. OSPF와 함께 가장 많이 사용하는 IGP이다.
5. Unequal Cost Load Balancing (Metric이 다른 경로로 부하 분산 가능)
6. OSPF에 비해 기본적인 설정이 간단하다.
7. 중소규모의 네트워크에서 설정 및 관리가 용이하다.
8. SIA(Stuck In Active): 특정 라우터가 네트워크에서 분리되고 그 원인을 찾기 힘들어 장애처리에 많은 시간이 걸릴 수 있다.

![https://s3-us-west-2.amazonaws.com/secure.notion-static.com/688078ae-9a6c-491b-bff1-548f119c4e8d/Untitled.png](https://s3-us-west-2.amazonaws.com/secure.notion-static.com/688078ae-9a6c-491b-bff1-548f119c4e8d/Untitled.png)

- 실습

### EIGRP 기본 설정

```
1. R1(config)#router eigrp [ASN] 
2. R1(config-router)#eigrp router-id [Router ID] 
3. R1(config-router)#network [네트워크] [Wildcard Mask]
```

1. AS Number: 1~65535 사이의 적당한 값을 사용하며 관리자가 임의의 값을 적당히 지정하면 된다. 모든 라우터는 같은 AS 번호를 사용해야 한다.
2. Router ID 선출 우선순위는

    1. Router-id 명령    2. 가장 높은 루프백 IP    3. 가장 높은 물리인터페이스 IP

3. Network 명령: EIGRP에 포함시킬 네트워크를 지정하는 방법은 다양하다. Wildcard Mask 값을 생략하여 설정할 수도 있다.

### EIGRP Database

1. Neighbor 구성 및 네이버 테이블 생성
2. 라우팅 정보 교환 및 토폴로지 테이블 생성
3. 라우팅 경로 계산 및 라우팅 테이블 저장

### EIGRP 패킷

1. 인접 라우터와 네이버 관계를 형성/유지, 라우팅 정보 전송, 라우팅 테이블 유지를 위해 여러 패킷을 사용한다.
2. 패킷의 종류는 Hello 패킷, Update 패킷, 라우팅정보 요청 패킷, 응답 및 수신확인 패킷이 있다.

### Hello 패킷

1. 네이버를 구성하고 유지하기 위해 사용된다.
2. Hello 패킷은 멀티캐스트 주소 224.0.0.10을 목적지 IP주소로 사용한다.
3. EIGRP는 인접 라우터에게 주기적으로 Hello 패킷을 전송한다.
4. Hello 주기 3배에 해당되는 시간 동안 Hello 패킷을 받지 못하면 관계 해제한다.
5. Hello-interval은 라우터 자신이 Hello 패킷을 전송하는 주기이며, Hold-Time은 인접 라우터에게 알려주는 자신의 홀드 시간이다.

    Encapsulation : Hello-interval : Hold-Time

    이더넷, HDLC, PPP, Frame-relay Point-to-Point : 5 : 15

    T1이하의 NBMA, Frame-relay Multipoint : 60 : 180

6. Hello-Interval 및 Hold time 주기 변경

    ```
    R1(config-subif)#ip hello-interval eigrp 1 [시간] 
    R1(config-subif)#ip hold-time eigrp 1 [시간]
    ```

### Update 패킷

1. 라우팅 정보를 전송할 때 사용되는 패킷이다.
2. 업데이트 패킷의 목적지 주소는 경우에 따라 유니캐스트, 멀티캐스트(224.0.0.10)을 사용한다. Broadcast Multi Access Network에서 Update 패킷은 224.0.0.10으로 보내고, 특정 네이버에게서 수신확인 패킷을 수신하지 못한 경우 해당 네이버에게 유니캐스트로 재전송한다.
3. Non-Broadcast Multi Access Network에서는 네이버 IP 주소로 전송한다.
4. Point-to-Point Network에서도 네이버 IP 주소로 전송한다.

### 라우팅 정보요청 패킷

1. 정보요청 패킷(Query Packet)은 라우팅 정보를 요청할 때 사용하는 패킷이다.
2. 목적지 주소는 업데이트 패킷과 비슷하다.
3. 자신의 라우팅 테이블에 있는 경로가 다운되거나 메트릭 값이 증가하고, 토폴로지 테이블에 대체경로(feasible successor)가 없을 때 인접 라우터에게 해당 경로에 대한 정보를 요청하기 위해 사용된다.

### 응답 패킷

1. 응답 패킷(Reply Packet)은 요청받은 라우팅 정보를 전송할 때 사용되는 패킷이다.
2. 목적지 주소는 항상 유니캐스트를 사용한다.

### 수신확인 패킷

1. 수신확인 패킷(Acknowledgement Packet)은 업데이트, 라우팅 정보요청, 응답 패킷의 수신을 확인해 줄 때 사용하는 패킷이다.
2. 헬로패킷에 대해서는 수신확인을 하지 않는다.
3. 목적지 주소는 항상 유니캐스트를 사용한다.

### EIGRP Metric

1. EIGRP는 대역폭(Bandwidth), 지연(Delay), 신뢰도(Reliability), 부하(Load), MTU(Maximum Transmission Unit), Hop Count 을 사용하여 경로 결정한다.
2. Hop Count 조정 (기본값은 100)

    ```
    R1(config-router)#metric maximum-hops [1~255]
    ```

3. MTU는 목적지까지 가는 경로의 각 Interface의 값 중에서 가장 작은 것이 선택된다.
4. EIGRP Metric 공식

    ```
    K5 = 0 인 경우 
    [K1*BW + K2*BW / (256-Load) + K3*DLY] * 256 
    K5 = 0 이 아닌 경우 
    [K1*BW + K2*BW / (256-Load) + K3*DLY] * 256 * K5 / (Reliability + K4)
    ```

5. BW는 [10^10 / 가장 작은 Bandwidth] 이고 내림정수로 한다.
6. DLY는 목적지까지 가는 경로의 모든 Delay 값의 합을 10으로 나눈 것이다.
7. 기본적인 K 상수 값은 K1/K3는 활성(1), K2/K4/K5는 비활성(0)이다.
8. 결과적인 공식은 [BW + DLY] *256 이다.
9. 같은 EIGRP AS 내부 라우터들은 K 상수 값이 동일해야 한다.

### EIGRP AD

1. 내부 네트워크의 EIGRP AD는 90이고, 외부 네트워크의 EIGRP AD는 170이다.
2. 루프백 재분배하고 확인해 본다.

    ```
    R1(config-router)#redistribute connected
    ```

### DUAL (Diffusing Update Algorithm)

1. EIGRP는 최적의 라우팅 경로를 계산하기 위하여 DUAL 알고리즘을 이용한다.
2. FD(Feasible Distance): 목적지 네트워크까지의 최적 Metric
3. RD(Reported Distance): 네이버 라우터에서부터 목적지 네트워크까지의 Metric

※ RD는 AD(Advertised Distance)라고도 한다.

※ EIGRP Topology Table에는 RD 값도 저장한다.

1. Successor: 최적 경로에 있는 네이버
2. Feasible Successor: Successor가 아닌 라우터 중에서 ‘RD < FD’라는 조건을 만족하는 네이버
3. EIGRP Topology Table에서 Successor 및 Feasible Successor를 확인할 수 있으며 대체경로도 확인할 수 있다.

### DUAL 동작

1. Update 패킷을 수신 받았을 때 경우에 따라 EIGRP DUAL 동작 방식이 다르다.
2. 기존의 경로보다 더 좋은 Metric 수신했을 때
    1. 새로운 경로를 준 네이버를 Successor로 지정한다.
    2. 새로운 경로를 다른 네이버에게 알린다.
3. 기존의 경로보다 나쁜 Metric을 Successor가 아닌 네이버로부터 수신했을 때
    1. 무시하고 아무 것도 하지 않는다.
4. 기존의 경로보다 나쁜 Metric을 Successor로부터 수신했고 Feasible Successor가 있을 때
    1. Feasible Successor를 Successor로 지정하고 새로운 경로를 다른 네이버에게 알린다.
5. 기존의 경로보다 나쁜 Metric을 Successor로부터 수신했고 Feasible Successor가 없을 때
    1. 네이버에게 요청(Query) 패킷을 전송하여 확산(Diffusion)한다.
    2. 네이버로부터 응답 패킷을 모두 수신하면 Successor 및 Feasible Successor를 결정한다.
    3. 새로운 경로를 다른 네이버에게 알린다.
6. 요청 패킷을 전송하고 응답 패킷을 수신 받지 못한 상태를 Active 상태라고 하고, 응답을 받았거나, 요청 패킷을 전송하지 않은 상태를 Passive 상태라고 한다.
7. Passive 상태에서만 해당 경로에 대해 라우팅 계산을 하며 응답 패킷을 보낼 수 있게 된다.

### Unequal Cost Load Balancing

1. 메트릭 값이 다른 경로에 대한 부하분산을 비균등 부하분산이라고 한다.
2. 비균등 부하분산이 되려면
    1. Feasible Successor를 통하는 경로이어야 한다.
    2. 비균등 부하분산 하고자 하는 경로의 메트릭이 FD*Variance 값 이내이어야 한다.

    ```
    R1(config-router)# variance [값]
    ```

### EIGRP Authentication

```
R1(config)# Key chain [WORD] 
R1(config-keychain)# key 1 
R1(config-keychain-key)# key-string [Pass] 

R1(config-if)# ip authentication key-chain eigrp [ASN] [WORD] 
R1(config-if)# ip authentication mode eigrp [ASN] md5
```
