## ğŸ™‹ğŸ»â€â™€ï¸ ìŠ¤ë¬¼ë‹¤ì„¯ë²ˆì§¸ ë¹„ëŒ€ë©´ ìˆ˜ì—…

---

# ë‚´ìš© ì •ë¦¬

---

# ìŠ¤ì¼€ì¥´ë§ ê´€ë¦¬

# ë‹¨ì›ëª©í‘œ

---

- at
- crontab

---

## at ëª…ë ¹ì–´

at ë°ëª¬ì€ ì§€ì •í•œ ì‹œê°„ì— ì–´ë– í•œ ì‘ì—…ì´ ì‹¤í–‰ë  ìˆ˜ ìˆë„ë¡ ì‘ì—… ìŠ¤ì¼€ì¤„ì„ ì˜ˆì•½ ì²˜ë¦¬í•´ ì£¼ëŠ” ê¸°ëŠ¥ì„ í•œë‹¤. 
at ìŠ¤ì¼€ì¤„ì„ ì‚¬ìš©í•˜ê¸° ìœ„í•´ì„œëŠ” at ë°ëª¬ì´ ì‘ë™í•˜ê³  ìˆì–´ì•¼ í•˜ë¯€ë¡œ, ë‹¤ìŒê³¼ ê°™ì´ atd ë°ëª¬ì„ ë™ì‘ì‹œí‚¨ë‹¤.

```bash
# systemctl restart atd.service
# systemctl status atd.service 
* atd.service - Job spooling tools
   Loaded: loaded (/usr/lib/systemd/system/atd.service; enabled; vendor preset: enabled)
   **Active: active (running)** since Wed 2020-05-06 12:20:50 KST; 9s ago
 Main PID: 66418 (atd)
    Tasks: 1
   CGroup: /system.slice/atd.service
           `-66418 /usr/sbin/atd -f

May 06 12:20:50 server1.example.com systemd[1]: Started Job spooling tools.
```

[ëª…ë ¹ì–´ í˜•ì‹]

```bash
# at [time]
Usage: at [-V] [-q x] [-f file] [-m] time
       at [-V] [-q x] [-f file] [-m] -t [[CC]YY]MMDDhhmm
       at -c job [job...]
       (atq | at -l) [-V] [-q x]
       (atrm | at -d | at -r) [-V] [-q x] job ...
       batch [-V] [-f file] [-m]
```

[ëª…ë ¹ì–´ ì‚¬ìš©ì˜ˆ]

```bash
â–  ì‘ì—… ì„ ì–¸
# at 1300
# at 10:00pm today

â–  ì‘ì—… í™•ì¸
# at -l
# atq

â–  ì‘ì—… ì·¨ì†Œ
# atrm N  (N : Job ID)
# at -r N
```

### [EX1] at ëª…ë ¹ì–´ ê°„ë‹¨í•œ í…ŒìŠ¤íŠ¸

[TERM1] ê´€ë¦¬ì ëª¨ë‹ˆí„°ë§ ìœˆë„ìš° 1

```bash
# tty
/dev/pts/3
```

[TERM2] ê´€ë¦¬ì ëª…ë ¹ì–´ ìœˆë„ìš° 2

```bash
# date
Tue Mar 31 14:45:50 KST 2020

# at 1447
at> echo hello > /dev/pts/2
at> <EOT>
job 1 at Tue Mar 31 14:47:00 2020
at> <CTRL + D>        <----- '<CTRL + D>' ì…ë ¥
at> <EOT>
job 1 at Tue Mar 31 14:47:00 2020

# at 1600
at> echo
at> <EOT>
job 2 at Tue Mar 31 16:00:00 2020
# 
# at 1601
at> echo
at> <EOT>
job 3 at Tue Mar 31 16:01:00 2020
# 
# at   
Garbled time
# at 1700
at> sleep
at> <EOT>
job 4 at Tue Mar 31 17:00:00 2020

# at â€“l        (# atq)
2	Tue Mar 31 16:00:00 2020 a root
3	Tue Mar 31 16:01:00 2020 a root
4	Tue Mar 31 17:00:00 2020 a root
# atrm 2
# at -l
3	Tue Mar 31 16:01:00 2020 a root
4	Tue Mar 31 17:00:00 2020 a root
# at -r 3
# at -l
4	Tue Mar 31 17:00:00 2020 a root
# at -r 4
-> ì¶œë ¥ëœ ë‚´ìš©ì´ ì—†ìŒ

# cd /var/spool/at
# ls -l
total 16
-rwx------. 1 root root 2981 Dec 29 09:47 a0000301993ddc
-rwx------. 1 root root 2981 Dec 29 09:47 a0000401993ddd
-rwx------. 1 root root 2981 Dec 29 09:47 a0000501993dde
-rwx------. 1 root root 2981 Dec 29 09:48 a0000701993ddf
drwx------. 2 root root    6 Dec 29 09:47 spool
```

```bash
â–  at ëª…ë ¹ì–´ ì‚¬ìš©ì ì œí•œ
at ë°ëª¬ì„ ì‚¬ìš©í•  ìˆ˜ ìˆëŠ” ì‚¬ìš©ìë¥¼ ì œí•œí•  ìˆ˜ ìˆëŠ” ë°©ë²•ì´ ìˆë‹¤. /etc/at.allow íŒŒì¼ê³¼ /etc/at.deny íŒŒì¼ì„ ì´ìš©
í•˜ì—¬ atì„ ì‚¬ìš©í•  ìˆ˜ ìˆëŠ” ì‚¬ìš©ìë“¤ì„ ì§€ì •í•œë‹¤. 

at.deny íŒŒì¼ë§Œ ì¡´ì¬í•˜ë©´, at.deny íŒŒì¼ì— ì¡´ì¬í•˜ëŠ” ì‚¬ìš©ìëŠ” at  ëª…ë ¹ì–´ë¥¼ ìˆ˜í–‰í•  ìˆ˜ ì—†ê³ ,  at.deny íŒŒì¼ì— ì¡´ì¬í•˜ì§€ ì•ŠëŠ” ëª¨ë“  ì‚¬ìš©ìëŠ” at ëª…ë ¹ì–´ë¥¼ ìˆ˜í–‰í•  ìˆ˜ ìˆë‹¤.
at.allow íŒŒì¼ì´ ì¡´ì¬í•˜ë©´, at.allow íŒŒì¼ì— ì¡´ì¬í•˜ëŠ” ì‚¬ìš©ìë§Œ at ëª…ë ¹ì–´ë¥¼ ìˆ˜í–‰í•  ìˆ˜ ìˆë‹¤. at.allow íŒŒì¼ì´ì¡´ì¬í•˜ë©´, at.deny íŒŒì¼ì€ ë³´ì§€ ì•ŠëŠ”ë‹¤. 

The  /etc/at.allow  and /etc/at.deny files determine which user can submit
commands for later execution via at(1) or batch(1).

The format of the files is a list of usernames, one on each line.  Whitespace is not permitted.
The superuser may always use at.

If  the  file  /etc/at.allow  exists,  only  usernames mentioned in it are
allowed to use at.

If /etc/at.allow does not exist, /etc/at.deny is checked.
```

at ì„œë¹„ìŠ¤ : ì¼íšŒì„± ëª…ë ¹ì–´ë¥¼ ì‚¬ìš©í•  ë•Œ ì˜ˆì•½ì„ ì„¤ì •

ì‚¬ìš©ìì¤‘ ëˆ„êµ¬ë‚˜ ì‹¤í–‰ê°€ëŠ¥í•œ ëª…ë ¹ì–´ì´ë‹¤.

ì‚¬ìš©ìì¤‘ ê·¸ ëˆ„êµ¬ë‚˜ ì‚¬ìš©ì´ ê°€ëŠ¥í•œ ëª…ë ¹ì–´ë¼ë©´ ì•…ì˜ì ì¸ ëª©ì , ê·¸ëŸ´ ì˜ë„ê°€ ì—†ì—ˆì§€ë§Œ ì‹œìŠ¤í…œì— ë¶€í•˜ë¥¼ ì¼ìœ¼í‚¤ëŠ” ìŠ¤í¬ë¦½íŠ¸ë¥¼ ì‹¤í–‰ í•  ê°€ëŠ¥ì„±ë„ ì¡´ì¬

```bash
at     ì‹œìŠ¤í…œì˜ ë¶€í•˜ë¥¼ ì‹ ê²½ì“°ì§€ ì•Šê³  ì‹¤í–‰
batch  ì‹œìŠ¤í…œì˜ ë¶€í•˜ê°€ ì¼ì •ëŸ‰ ë‚´ë ¤ ê°”ì„ ë•Œ ì‹¤í–‰

/etc/at.allow  - ê´€ë¦¬ìê°€ ë”°ë¡œ ìƒì„±í•´ ì£¼ì–´ì•¼ í•˜ëŠ” íŒŒì¼
								 ì´ íŒŒì¼ì— ë“±ë¡ëœ ì‚¬ìš©ìëŠ” atì„ ì‚¬ìš© í•  ìˆ˜ ìˆë‹¤.
								 íŒŒì¼ì„ ìƒì„±í•˜ë©´ ìë™ìœ¼ë¡œ ëª¨ë“  ì‚¬ìš©ìì˜ ê¶Œí•œì€ ì—†ì–´ì§„ë‹¤.
								 ì´ íŒŒì¼ì„ ìƒì„±í•˜ëŠ” ìˆœê°„ at.denyëŠ” ì°¸ì¡°í•˜ì§€ ì•ŠëŠ”ë‹¤.
/etc/at.deny   - ê¸°ë³¸ìœ¼ë¡œ ì¡´ì¬í•˜ëŠ” íŒŒì¼
							 	 ì´ íŒŒì¼ì— ë“±ë¡ëœ ì‚¬ìš©ìëŠ” atì„ ì‚¬ìš© í•  ìˆ˜ ì—†ë‹¤.
ë³´ì•ˆ -> ë‹¤ ë§‰ì€ ë‹¤ìŒì— ì—´ì–´ì£¼ê¸° or ë‹¤ í—ˆìš©í•œ ë‹¤ìŒì— í•˜ë‚˜ì”© ë§‰ê¸°
				ì „ìê°€ í›¨ì”¬ í¸í•œ ë°©ë²•ì´ë‹¤.
at í”„ë¡œê·¸ë¨ì„ ì‹¤í–‰: ê·¸ëŸ¼ ë‚˜ëŠ” atì— ëŒ€í•˜ì—¬ ì–´ë– í•œ ì •ì±…ì„ ë§Œë“¤ê²ƒì¸ê°€?
```

### [EX] at ëª…ë ¹ì–´ ì‚¬ìš©ì ì œí•œ

```bash
< ì‚¬ì „ì‘ì—… > í•´ë‹¹ ê³„ì •ì´ ì¡´ì¬í•´ì•¼ í•œë‹¤. at1 at2
# /etc/passwd | grep at 
at1:x:1107:1107::/home/at1:/bin/bash
at2:x:1108:1108::/home/at2:/bin/bash
â‘  ê¸°ë³¸ ì‚¬í•­ ì ê²€
# ls -l /etc/at.*
-rw-r--r--. 1 root root 1 Oct 31  2018 /etc/at.deny

/etc/at.deny > atì„ ì‚¬ìš©í• ìˆ˜ ìˆëŠ” ì‚¬ìš©ìì— ëŒ€í•œ ì œí•œì„ ê±¸ì–´ì¤€ë‹¤. ê¸°ë³¸ì€ ëª¨ë“  ì‚¬ìš©ìê°€ ì‚¬ìš©í• ìˆ˜ ìˆë„ë¡ íŒŒì¼ ë‚´ë¶€ì—ëŠ” ì•„ë¬´ ë‚´ìš©ì´ ì—†ë‹¤.
# cat /etc/at.deny

#

[root@server1 ~]# su - at1
[at1@server1 ~]$ date
Tue Mar 31 14:55:29 KST 2020
[at1@server1 ~]$ at 1500
You do not have permission to use at. > at1 ì‚¬ìš©ìëŠ” /etc/at.deny íŒŒì¼ì— ì‘ì„±ë˜ì–´ ìˆê¸° ë•Œë¬¸ì— at ëª…ë ¹ì–´ë¥¼ ì‚¬ìš©í• ìˆ˜ ì—†ë‹¤.

[root@server1 ~]# su -  at2
[at2@server1 ~]$ at 1500
at>     > at2 ì‚¬ìš©ìëŠ” ì‚¬ìš©ê°€ëŠ¥í•˜ë‹¤.

/etc/at.deny íŒŒì¼ì— ë“±ë¡ë˜ì–´ ìˆëŠ” ì‚¬ìš©ìë§Œ ì‚¬ìš© ë¶ˆê°€ëŠ¥í•˜ë‹¤.
[íŒŒì¼ ì›ë³µ]
# > /etc/at.deny

â‘¡ /etc/at.allow íŒŒì¼ ìƒì„±
# cat /etc/at.allow
at2
â‘¢ at1 ì‚¬ìš©ìë¡œ í…ŒìŠ¤íŠ¸
# su - at1
ë§ˆì§€ë§‰ ë¡œê·¸ì¸: í™”  3ì›” 31 14:55:25 KST 2020 ì¼ì‹œ pts/2
[at1@server1 ~]$ at 1500
You do not have permission to use at. > at ëª…ë ¹ì–´ ì‚¬ìš©ë¶ˆê°€
â‘£ at2 ì‚¬ìš©ìë¡œ í…ŒìŠ¤íŠ¸
[root@server1 ~]# su - at2
ë§ˆì§€ë§‰ ë¡œê·¸ì¸: í™”  3ì›” 31 14:56:03 KST 2020 ì¼ì‹œ pts/2
[at2@server1 ~]$ at 1500
at> <EOT>
job 7 at Tue Mar 31 15:00:00 2020
```

## crontab ëª…ë ¹ì–´

cron ë°ëª¬ì€ ê°™ì€ ì‘ì—…ì„ ì£¼ê¸°ì ìœ¼ë¡œ ë°˜ë³µ ì‹¤í–‰ë˜ë„ë¡ í•˜ëŠ” ì‘ì—… ìŠ¤ì¼€ì¤„ìš© ë°ëª¬ìœ¼ë¡œ, ë§¤ë¶„, ë§¤ì‹œ, ë§¤ì¼, ë§¤ì£¼, ë§¤ì›”, ë§¤ìš”ì¼ ë‹¨ìœ„ë¡œ cron ë°ëª¬ì— ì˜í•´ì„œ ì‘ì—…ì´ ì‹¤í–‰ë  ìˆ˜ ìˆë‹¤. /etc ë””ë ‰í† ë¦¬ì— ë³´ë©´ ì‹œ, ì¼, ì£¼, ì›”, ìš”ì¼ ë‹¨ìœ„ í˜•íƒœë¡œ cron ë””ë ‰í† ë¦¬ê°€ ì¡´ì¬í•˜ë©°, ì´ë“¤ ë””ë ‰í† ë¦¬ì—ëŠ” ì‘ì—… ì˜ˆì•½ ìŠ¤í¬ë¦½íŠ¸ë“¤ì´ ë“¤ì–´ ìˆë‹¤. /etc/cron/daily ë””ë ‰í† ë¦¬ì•ˆì—ëŠ” ì—¬ëŸ¬ ê°€ì§€ ìŠ¤í¬ë¦½íŠ¸ë“¤ì´ ì¡´ì¬í•˜ëŠ”ë°, ë§¤ì¼ ì´ë“¤ ìŠ¤í¬ë¦½íŠ¸ëŠ” cron ë°ëª¬ì— ì˜í•´ì„œ ìë™ì ìœ¼ë¡œ ì‹¤í–‰ëœë‹¤.

(cron ë°ëª¬ì‹¤í–‰)

cronìœ¼ë¡œ ì‘ì—… ìŠ¤ì¼€ì¤„ì„ ì˜ˆì•½í•˜ê¸° ìœ„í•´ì„œëŠ” crond ë°ëª¬ì„ ì‘ë™ì‹œì¼œì•¼ í•˜ëŠ”ë° ë‹¤ìŒê³¼ ê°™ì´ ë°ëª¬ì„ ì¬ì‹¤í–‰í•´ ì£¼ë©´ ëœë‹¤. ì´ ì‘ë™í•˜ê³  ìˆì–´ì•¼ í•œë‹¤. ê·¸ëŸ¬ë¯€ë¡œ, ì‘ì—… ìŠ¤ì¼€ì¤„ì„ ì˜ˆì•½í•˜ê¸° ì „ì— í•­ìƒ crond ë°ëª¬ì´ ì‘ë™ë  ìˆ˜ ìˆë„ë¡ ë‹¤ìŒê³¼ ê°™ì´ ì²˜ë¦¬í•œë‹¤.

```bash
# systemctl restart crond.service 
# systemctl enable crond.service
# systemctl is-enabled crond.service 
enabled
```

[ëª…ë ¹ì–´ í˜•ì‹]

```bash
# crontab [-u user] file
# crontab [-u user] [ -e | -l | -r ]
-e (edit user is crontab)
-l (list user is crontab)
-r (delete user is crontab)
-i (prompt before deleting user is crontab)
-s (selinux context)
```

[ëª…ë ¹ì–´ ì‚¬ìš© ì˜ˆ]

```bash
â–  ì‘ì—… ì„ ì–¸
# crontab â€“e (-e : Edit, # vi /var/spool/cron/<ì‚¬ìš©ìì´ë¦„>)
# crontab -e -u user01

â–  ì‘ì—… í™•ì¸
# crontab â€“l (-l : List, # cat /var/spool/cron/<ì‚¬ìš©ìì´ë¦„>)

â–  ì‘ì—… ì‚­ì œ
# crontab â€“r   (ì£¼ì˜) (-r : Remove, # rm /var/spool/cron/<ì‚¬ìš©ìì´ë¦„>)
```

![https://s3-us-west-2.amazonaws.com/secure.notion-static.com/2f9128d0-14c9-4b3f-b087-863221214947/Untitled.png](https://s3-us-west-2.amazonaws.com/secure.notion-static.com/2f9128d0-14c9-4b3f-b087-863221214947/Untitled.png)

ê¸°ë³¸ í˜•ì‹

### [EX1] at ëª…ë ¹ì–´ì˜ ì‹¤ë¬´ì˜ˆ(ë°±ì—… ìŠ¤í¬ë¦½íŠ¸ ì‹¤í–‰)

```bash
# cat /root/bin/backup.sh   
--------------------------------------------
(ë°±ì—… ìŠ¤í¬ë¦½íŠ¸ ë‚´ìš© ì˜ˆì œ)
cd /home
tar cvzf /backup/home.`date +%m%d`.tar.gz .
--------------------------------------------

(í˜„ì¬)        # /root/bin/backup.sh 
(ì§€ì •ëœ ì‹œê°„) # echo /root/bin/backup.sh | at 1200
```

### [EX2] ì—…ê·¸ë ˆì´ë“œ ìˆ˜í–‰ í›„ ì¬ë¶€íŒ…í•˜ëŠ” ê²½ìš°

[TERM1] ì—…ë°ì´íŠ¸ í„°ë¯¸ë„

```bash
# yum -y update 
.... ì—…ë°ì´íŠ¸ ìˆ˜í–‰ ì¤‘ ......
.... ë‚¨ì€ ì‘ì—… ì‹œê°„ ì˜ˆìƒ : 10ë¶„ ......
```

[TERM2] ì¬ë¶€íŒ… ëª…ë ¹ì–´ ìˆ˜í–‰ í„°ë¯¸ë„

```bash
# at now +30 mins
--------------------------------
at> shutdown -r now
at> <CTRL + D>
--------------------------------
```

### [EX3] crontab ëª…ë ¹ì–´ì˜ ê¸°ë³¸ ì‚¬ìš©ë²•(ì‰¬ëŠ” ì‹œê°„ í‘œì‹œ)

ì•„ìŠ¤í‚¤ì•„íŠ¸ ë§í¬

[Text to ASCII Art Generator (TAAG)](http://patorjk.com/software/taag/#p=display&f=Graffiti&t=Type%20Something%20)

```bash
# cat /etc/crontab
SHELL=/bin/bash
PATH=/sbin:/bin:/usr/sbin:/usr/bin
MAILTO=root

# For details see man 4 crontabs

# Example of job definition:
# .---------------- minute (0 - 59)
# |  .------------- hour (0 - 23)
# |  |  .---------- day of month (1 - 31)
# |  |  |  .------- month (1 - 12) OR jan,feb,mar,apr ...
# |  |  |  |  .---- day of week (0 - 6) (Sunday=0 or 7) OR sun,mon,tue,wed,thu,fri,sat
# |  |  |  |  |
# *  *  *  *  * user-name  command to be executed
```

```bash
* * * * * CMD         : ë§¤ ë¶„ ëª…ë ¹ì–´ ì‹¤í–‰
30 * * * * CMD        : ë§¤ ì‹œê°„ 30ë¶„ë§ˆë‹¤ ì‹¤í–‰
10,15,45 * * * * CMD  : ë§¤ì‹œê°„ 10,15,45ë¶„ì— ì‹¤í–‰
30 3 * * * CMD        : ë§¤ì¼ 3ì‹œ 30ë¶„ì— ì‹¤í–‰
42 2 3 * * CMD        : ë§¤ì›” 3ì¼ 2ì‹œ 45ë¶„ì— ì‹¤í–‰
*/10 * * * * CMD      : 10ë¶„ë§ˆë‹¤ ì‹¤í–‰ë˜ëŠ” ìŠ¤í¬ë¦½íŠ¸
30 3 * * 1-5 CMD      : ì›”-ê¸ˆê¹Œì§€ 3ì‹œ 30ë¶„ì— ì‹¤í–‰

â— crontab ì„¤ì •ì„ í•˜ëŠ” ê²½ìš° í”¼í•´ì•¼í•˜ëŠ” ì‹œê°„
	00ì‹œ
	ì •ì‹œ
ìš´ì˜ì²´ì œëŠ” crontab
anacron * < ì •ê°
ë§¤ì‹œê°„ ì •ê°ì€ í”¼í•˜ê³  ì›¬ë§Œí•˜ë©´ 5ë¶„ ì´í›„ ì‹œê°„ìœ¼ë¡œ ì„¤ì •ì„ í•˜ëŠ” ê²ƒì´ ì¢‹ë‹¤.
íŠ¹íˆ í”¼í•´ì•¼ í•˜ëŠ” ì‹œê°„ 00:00:00

ê·¸ë ‡ë‹¤ë©´ crontabì„ ì´ìš©í•˜ì—¬ ì–´ë–¤ê²ƒì„ ìŠ¤ì¼€ì¥´ë§ìœ¼ë¡œ ê±¸ì–´ì„œ ì‚¬ìš©í•  ê²ƒì¸ê°€?
```

```bash
# systemctl restart crond.service
# systemctl status crond.service

ê¸°ë³¸ íŒŒì¼ ì‘ì„±
# mkdir /etc/MESS
# vi /etc/MESS/CoffeeTime.txt

# crontab â€“e
50 10-18 * * 6,7  wall < /etc/MESS/CoffeeTime.txt

or 

50 10-16 * * 1-5  wall < /etc/MESS/CoffeeTime.txt
```

```bash
crontab íŒŒì¼ í™•ì¸
# crontab -l
50 10-18 * * 6,7 wall < /etc/MESS/CoffeeTime.txt

crontab ì‚­ì œ
# crontab -r

crontab íŒŒì¼ í™•ì¸
# crontab -l
no crontab for root
```

```bash
# crontab â€“e
VI íŒŒì¼ë¡œ "/tmp/crontab.sRMFc3" 0L, 0C ë¼ê³  ì™¼ìª½ ë°‘ì— ìƒì„±
crontabì€ ì—ë””í„°ë¥¼ ì‹¤í–‰í•˜ë©´ ì„ì‹œíŒŒì¼ë¡œ ìƒì„±ì´ ëœë‹¤. ê·¸ë¦¬ê³  ì €ì¥ì„ í•˜ëŠ”ìˆœê°„ ë°”ë¡œ ì ìš©ë˜ì–´ ë™ì‘í•œë‹¤.
ì €ì¥í•˜ê³  ë¹ ì ¸ë‚˜ê°€ë©´ crontab: installing new crontab ì„ ì¶œë ¥í•˜ë©° ë°”ë¡œ ì‹¤í–‰ ì‹œì‘

í•´ê²°ë°©ì•ˆ
ì„ì‹œë¡œ íŒŒì¼ì„ ì‘ì„±í•œë’¤ í™•ì¸í•˜ê³  ë®ì–´ì“°ê¸° 
# cd
# vi crontablist
# cat crontablist
50 10-18 * * 6,7 wall < /etc/MESS/CoffeeTime.txt
# cat crontablist  >> /var/spool/cron/root
# crontab -l
50 10-18 * * 6,7 wall < /etc/MESS/CoffeeTime.txt

```

```bash
ì‚¬ìš©ìì˜ crontab
# crontab -e -u [USERNAME] 
# crontab -l -u [USERNAME] 
# crontab -r -u [USERNAME] 
```

### [EX4] DB ì‚¬ìš©ìë¡œ ë¡œê·¸ì¸/ë°±ì—…

```bash
# crontab â€“e
01 04 * * * /root/bin/DB_backup.sh
# vi /root/bin/DB_backup.sh
-----------------------------------
#!/bin/bash

sqlplus /as sysdba << EOF
CMD ;
CMD ;
CMD ;
EOF
-----------------------------------
```

### [EX5] ìˆ˜ì—… ì¢…ë£Œ í›„ ì„œë²„ Power OFF

```bash
(Linux)# echo "/sbin/poweroff" | at now + 5 minutes  /* 5ë¶„ ë’¤ì— ë¦¬ëˆ…ìŠ¤ ì„œë²„ ì¢…ë£Œ */

(Window)C:\> shutdown /s /t 600  /* 10ë¶„ ë’¤ì— ìœˆë„ìš° ì„œë²„ ì¢…ë£Œ */
         C:\> shutdown /a         /* shutdown ì·¨ì†Œ */
```

```bash
ë¦¬ëˆ…ìŠ¤ 2
íŒ -ë³´ê³ ì„œ ì‘ì„±í•˜ê¸°
>ë³´ì¶©
ë„¤íŠ¸ì›Œí¬
ë¦¬ëˆ…ìŠ¤ 3
mini íŒ€ - í”„ë¡œì íŠ¸
1/29
```

# ë°±ì—… & ë³µêµ¬

# ë‹¨ì›ëª©í‘œ

---

- ë°±ì—… ê°œìš”
- ë°±ì—… ì¢…ë¥˜
- ë°±ì—… / ë³µêµ¬ ëª…ë ¹ì–´

---

# ë‹¨ì›ëª©í‘œ

---

**tarë¥¼ ì´ìš©í•œ ë¡œì»¬ ë°ì´í„° ë°±ì—…**

**tarë¥¼ ì´ìš©í•œ íŠ¹ì • ë””ë ‰í† ë¦¬ ë°ì´í„° ìë™ ë°±ì—…**

**tarë¥¼ ì´ìš©í•œ ë¡œì»¬ ë°ì´í„° ë¯¸ëŸ¬ë§í•˜ê¸°**

**tarë¥¼ ì´ìš©í•œ ë¦¬ëˆ…ìŠ¤ ìš´ì˜ì²´ì œ ë°±ì—…**

**rsyncë¥¼ ì´ìš©í•œ ë¡œì»¬ ë°ì´í„° ë°±ì—… ë° ì„œë²„ ë™ê¸°í™”**

**rsync ì„œë²„ ì„¤ì •(/etc/rsyncd.conf)**

---

## ë°±ì—… ê°œìš”(Backup Overview)

ë°±ì—…(Backup)ì˜ ê°œë… :Â ë°ì´í„°ë‚˜ ì •ë³´ê°€ ì§€ë‹Œ ê°€ì¹˜ë¥¼ ë³´ì¡´í•˜ëŠ” ê²ƒìœ¼ë¡œ ì™¸ë¶€ì˜ ì¹¨ì…ìë¡œë¶€í„° ë³´í˜¸, ì˜ˆê¸°ì¹˜ ëª»í•œ ì‚¬ê³ ë¡œë¶€í„°ì˜ ë³µì›, ì‹œìŠ¤í…œ ë°±ì—…ì€ ë§¤ì¼ í•´ì•¼ í•œë‹¤.

```bash
â–¶ ë°±ì—…ì´ í•„ìš”í•œ ì´ìœ  Â  
- ì˜ˆê¸°ì¹˜ ëª»í•œ ì²œì¬ì§€ë³€ Â  
- ê´€ë¦¬ìì˜ ì‹¤ìˆ˜ Â  
- ê¸°ê³„ì  ì˜¤ë¥˜ Â  
- ì†Œí”„íŠ¸ì›¨ì–´ ë²„ê·¸

â–¶ ì£¼ìš” ë°±ì—… ëŒ€ìƒ Â  
- ì „ì²´ íŒŒì¼ ì‹œìŠ¤í…œ Â  
- ë§ˆì§€ë§‰ ë°±ì—… í›„ì˜ ë³€ê²½ëœ íŒŒì¼ ì‹œìŠ¤í…œ Â  
- ì–´í”Œë¦¬ì¼€ì´ì…˜ Â  
- ê°ì¢… í™˜ê²½ ì„¤ì • íŒŒì¼ Â  
- ì‚¬ìš©ì íŒŒì¼ ë“±

â–¶ ë°ì´í„° ì†ì‹¤ì˜ ì£¼ìš” ì›ì¸ Â  
- í•˜ë“œì›¨ì–´ì ì¸ ì‚¬ìœ  Â  
- ì†Œí”„íŠ¸ì›¨ì–´ì ì¸ ì‚¬ìœ  Â  
- ì‚¬ìš©ìì˜ ë¶€ì£¼ì˜ Â  
- í•´ì»¤ì˜ ì¹¨ì…
- ê¸°íƒ€ ë„ë‚œ, ìì—°ì¬í•´
```

```bash
(ì£¼ì˜) ë°±ì—…ì‹œê°„ && ë³µêµ¬ì‹œê°„

ë°±ì—…ì€ ë³µêµ¬ë¥¼ ìœ„í•´ì„œ ì¡´ì¬í•œë‹¤. í•˜ì§€ë§Œ ë°±ì—…ì€ ê±°ì˜ ë§¤ì¼ ê°™ì´ í•˜ê³ , ë³µêµ¬ëŠ” ì¼ë…„ì— í•œë²ˆ ìˆì„ê¹Œ ë§ê¹Œí•˜ëŠ” ì‘ì—…ì´ë‹¤. ë°±ì—…ì‹œê°„ì´ ê¸´ í˜•íƒœë¡œ ì‘ì—…ì„ í•˜ë©´ ë³´í†µì€ ë³µêµ¬ì‹œê°„ì€ ì¤„ì–´ ë“¤ê³ , ë°±ì—…ì‹œê°„ì„ ì§§ê²Œ í•˜ëŠ” ë°©ì‹ì„ íƒí•˜ ë©´ ë³´í†µì€ ë³µêµ¬ì‹œê°„ì´ ê¸¸ì–´ ì§„ë‹¤. ë”°ë¼ì„œ ë°±ì—…ì‹œê°„ê³¼ ë³µêµ¬ì‹œê°„ì€ ì ë‹¹í•˜ê²Œ ì¡°ì ˆí•  í•„ìš”ê°€ ìˆë‹¤.
```

## ë°±ì—… ì¢…ë¥˜(Backup Type)

ì¼ë°˜ì ìœ¼ë¡œ ë°±ì—… ì¢…ë¥˜ëŠ”

(ã„±) ì™„ì „ ë°±ì—…(Full Backup),

(ã„´) ì¦ë¶„ ë°±ì—…(Incremental Backup)

(ã„·) ì°¨ë“±ë°±ì—…(Differential Backup)

ë“±ì´ ìˆë‹¤.

(1) ì™„ì „ ë°±ì—…(Full Backup)

ëª¨ë“  ë°ì´í„°ë¥¼ í†µì§¸ë¡œ í•œ ë²ˆì— ë°±ì—…í•˜ëŠ” ë°©ë²•ì„ ë§í•œë‹¤. ë§ ê·¸ëŒ€ë¡œ ëª¨ë“  ê²ƒì„ ë°±ì—…í•˜ê¸° ë•Œë¬¸ì— ë°±ì—…í•˜ëŠ”ë° ì˜¤ëœ ì‹œê°„ì´ ê±¸ë¦¬ë©°, ë°±ì—… ë§¤ì²´ì˜ìš©ëŸ‰ ë˜í•œ ì»¤ì•¼ í•˜ë¯€ë¡œ,ë¹„ìš© ì†Œëª¨ê°€ ë§ì€ ê²ƒì´ ë‹¨ì ì´ë‹¤. ê·¸ëŸ¬ë‚˜ ì‹œìŠ¤í…œì— ë¬¸ì œê°€ ë°œìƒë˜ì—ˆì„ ë•Œ ë°œìƒë˜ê¸° ì´ì „ì˜ ìƒíƒœë¡œ ì‹œìŠ¤í…œì„ í™•ì‹¤íˆ ë³µêµ¬í•  ìˆ˜ ìˆëŠ” ì¥ì ì´ ìˆë‹¤. ë¦¬ëˆ…ìŠ¤ë¥¼ ì„¤ì¹˜í•œ í›„ì—ëŠ” ì™„ì „ ë°±ì—…ì„ í•˜ëŠ” ê²ƒì´ í–¥í›„ì— ë¦¬ëˆ…ìŠ¤ë¥¼ ì¬ì„¤ì¹˜ í•´ì•¼ í•  ê²½ìš°ë¥¼ ë¦¬ëˆ…ìŠ¤ë¥¼ ë‹¤ì‹œ ì„¤ì¹˜í•˜ì§€ ì•Šê³ ì„œë„ ë°±ì—…ì„ ë³µì›ì‹œì¼œ ë¶€íŠ¸ ë¡œë”ë§Œ ìˆ˜ì •í•´ ì£¼ë©´ ì„¤ì¹˜ ì›ìƒíƒœë¡œ ë˜ëŒë ¤ ë†“ì„ ìˆ˜ ìˆëŠ” ì´ì ì´ ìˆë‹¤.

(2) ì¦ë¶„ ë°±ì—…(Incremental Backup)

ì¼ë°˜ì ìœ¼ë¡œ ë°±ì—…ì€ ì™„ì „ ë°±ì—…ê³¼ ì¦ë¶„ ë°±ì—…ì„ ë³‘í–‰í•˜ëŠ”ë°, ì¦ë¶„ ë°±ì—…ì€ ì™„ì „ ë°±ì—…í•œ ì´í›„ì— ë³€ê²½ëœ ë°ì´í„°ë§Œì„ ë°±ì—… í•˜ëŠ” ë°©ë²•ì´ë‹¤. ìµœê·¼ ë°±ì—…ì´í›„ì— ë³€ê²½ëœ íŒŒì¼ì— ëŒ€í•´ì„œë§Œ ë°±ì—…ì´ ì´ë¤„ì§€ê¸° ë•Œë¬¸ì— ë¹ ë¥¸ ì‹œê°„ ë‚´ì— ë°±ì—…ì´ ì´ë¤„ì§€ëŠ” ì¥ì ì´ ìˆë‹¤. ë¦¬ëˆ…ìŠ¤ ì„¤ì¹˜ ì´í›„ì— ìƒì„±ë˜ëŠ” ë°ì´í„°ì´í›„ì— íŒŒì¼ì— ëŒ€í•´ì„œ ì¦ë¶„ ë°±ì—…ìœ¼ë¡œ ë°±ì—…ì„ ë„ëª¨í•˜ëŠ” ê²ƒì´ ë¦¬ëˆ…ìŠ¤ ì‹œìŠ¤í…œì— ë¬¸ì œê°€ ë°œìƒë˜ë”ë¼ë„ ë¦¬ëˆ…ìŠ¤ë¥¼ ë‹¤ì‹œ ì„¤ì¹˜í•˜ì§€ ì•Šê³ ì„œë„ ì™„ì „ ë°±ì—…ì„ ë³µì›í•˜ì—¬ ê·¸ ì´í›„ì˜ ìƒì„±ëœ ë°ì´í„°ì´í›„ì— íŒŒì¼ì„ ë¬¸ì œ ë°©ìƒ ì´ì „ì˜ ìƒíƒœë¡œ ë˜ëŒë ¤ ë†“ì„ ìˆ˜ ìˆê²Œ ëœë‹¤.

(3) ì°¨ë“±ë°±ì—…(Differential Backup)

ë³´í†µ ì¦ë¶„ë°±ì—…ê³¼ ë¹„ìŠ·í•˜ê¸° ë•Œë¬¸ì— í˜¼ë™í•˜ëŠ” ê²½ìš°ê°€ ì—†ì§€ ì•ŠëŠ”ë°, ì°¨ë“± ë°±ì—…ì€ ì™„ì „ ë°±ì—…ì´ ì´ë¤„ì§„ ì´í›„ì˜ ëª¨ë“  ë°ì´í„°ì— ëŒ€í•´ì„œ ë°±ì—…ì´ ì´ë¤„ì§€ë„ë¡ í•˜ëŠ” ë°©ë²•ì´ë‹¤. ì¦ë¶„ ë°±ì—…ìœ¼ë¡œ ë°±ì—…ëœ ë°ì´í„°ê°€ ìˆë”ë¼ë„ ì°¨ë“± ë°±ì—…ì€ ì´ëŸ¬í•œ ê²ƒ ì„ ê°€ë¦¬ì§€ ì•Šê³ , ì „ì²´ ë°±ì—… ì´í›„ì˜ ëª¨ë“  ë°ì´í„°ë¥¼ ë°±ì—…í•˜ëŠ” ê²ƒì„ ë§í•œë‹¤. ì°¨ë“± ë°±ì—…ì€ ì™„ì „ ë°±ì—… ì´í›„ì˜ ëª¨ë“  íŒŒì¼ì— ëŒ€í•´ì„œ ë°±ì—…ì´ ì´ë¤„ì§€ê¸° ë•Œë¬¸ì— ë°ì´í„°ë¥¼ ë³µì›í•˜ëŠ”ë° ìˆì–´ì„œëŠ” ì‹œê°„ì´ ì˜¤ë˜ ê±¸ë¦¬ëŠ” ë¶ˆí¸í•¨ì´ ìˆì„ ìˆ˜ ìˆë‹¤.

```bash
ë³µêµ¬ë¥¼ í•œë²ˆì— ì„±ê³µ í•  ìˆ˜ ìˆë„ë¡ ìˆœì„œë¥¼ ì˜ ì§€ì •í•´ì•¼ í•˜ë©°
ê°€ì´ë“œ ë¬¸ì„œë¥¼ ì˜ ì‘ì„±í•´ë‘ì–´ì•¼ í•˜ê³  ë¬¸ì„œ ì‘ì„±ìê°€ ì•„ë‹Œ ë‹¤ë¥¸ ì‚¬ëŒì´ ë³µêµ¬ë¥¼ í•˜ë”ë¼ë„ í•œë²ˆì— ì„±ê³µí•  ìˆ˜ ìˆëŠ” ì²´ê³„ë¡œ ë§Œë“¤ì–´ ë‘ì–´ì•¼ í•œë‹¤.
ë¶„ê¸°ë³„, ì›”ì— í•œë²ˆì€ TESTì„œë²„ì— ë³µêµ¬ë¥¼ ì‹œë„
í•œë²ˆì— í•  ìˆ˜ ìˆë„ë¡ ì¸ë ¥ì„ ê¸°ìˆ 
â˜… í•œë²ˆì— ì„±ê³µ í•  ìˆ˜ìˆë„ë¡ í•˜ëŠ” ê²ƒì´ í¬ì¸íŠ¸ â˜…
```

## ë°±ì—…/ë³µêµ¬ ëª…ë ¹ì–´(Backup/Restore Command)

(1) ë°±ì—…/ë³µêµ¬ ëª…ë ¹ì–´ ì¢…ë¥˜

(ë°±ì—… ëª…ë ¹ì–´ì˜ íŠ¹ì§•)

â–  tar ëª…ë ¹ì–´	        ë§ˆìš´íŠ¸ëœ íŒŒì¼ì‹œìŠ¤í…œë‚´ì—ì„œ ë°±ì—…í•˜ëŠ” ëª…ë ¹ì–´

â–  cpio ëª…ë ¹ì–´         ë§ˆìš´íŠ¸ëœ íŒŒì¼ì‹œìŠ¤í…œë‚´ì—ì„œ ë°±ì—…í•˜ëŠ” ëª…ë ¹ì–´

â–  dump/restore    ëª…ë ¹ì–´ íŒŒì¼ì‹œìŠ¤í…œ ë‹¨ìœ„(íŒŒí‹°ì…˜ ë‹¨ìœ„)ë¡œ ë°±ì—…í•˜ëŠ” ëª…ë ¹ì–´

â–  dd ëª…ë ¹ì–´           ë””ìŠ¤í¬ ë§ˆì´ê·¸ë ˆì´ì…˜(Migration)í•˜ëŠ” ëª…ë ¹ì–´

ì´ ë¬¸ì„œì—ì„œëŠ” ê°€ì¥ ë§ì´ ì‚¬ìš©ë˜ê³  ìˆëŠ” tar ëª…ë ¹ì–´ë¥¼ í†µí•œ ë°±ì—… ë¶€ë¶„ë§Œì„ ë‹¤ë£¬ë‹¤.

(2) tar ëª…ë ¹ì–´

```bash
(ë°±ì—… ë°©ë²•)
# cd /home
# tar cf /mnt/backup/home-backup.tar .  (# tar cfz /mnt/backup/home-backup.tar.gz . ) 
(ì£¼ì˜) ë°±ì—… ë°›ì„ ë‹¹ì‹œì— ì ˆëŒ€ ê²½ë¡œ í˜•íƒœë¡œ ë°±ì—…ë°›ì§€ ì•ŠëŠ”ë‹¤.
(ë³µêµ¬ ë°©ë²•)
# cd /home
# tar tf /mnt/backup/home-backup.tar
# tar xf /mnt/backup/home-backup.tar

OPTIONS
  -c, --create                create a new archive
  -f, --file=ARCHIVE          use archive file or device ARCHIVE
  -z, --gzip, --gunzip, --ungzipfilter the archive through gzip
  -t, --list                  list the contents of an archive
  -x, --extract, --get        extract files from an archive
  -g, --listed-incremental=FILE    handle new GNU-format incremental backup
  -G, --incremental           handle old GNU-format incremental backup
  -j, --bzip2                 filter the archive through bzip2
  -p, --preserve-permissions,  extract permissions information
      --same-permissions
```

### [EX1] tar ëª…ë ¹ì–´ë¥¼ ì´ìš©í•œ í’€ë°±ì—…(Full Backup) & ì¦ë¶„ ë°±ì—…(Incremental Backup)

```bash
ë§¤ì¼ ë§¤ì¼ ì¦ê°€í•˜ëŠ” ë°ì´í„°ê°€ í° ì„œë²„ì—ì„œ í’€ë°±ì—…ì„ ë§¤ì¼ ê°™ì´ ë°›ëŠ” ë°©ë²•ì€ ì¢‹ì€ ë°©ë²•ì´ ì•„ë‹ˆë‹¤. ì¤‘ê°„ì— ì ë‹¹í•˜ê²Œ 
ì¦ë¶„ ë°±ì—…ì„ ì„ì–´ ì“°ëŠ” ë°©ë²•ì´ ì¢‹ë‹¤. tar ëª…ë ¹ì–´ë¥¼ í†µí•´ì„œ í’€ë°±ì—…ê³¼ ì¦ë¶„ ë°±ì—…ì„ ì ë‹¹í•˜ê²Œ ì„ì–´ ì“°ëŠ” ë°©ë²•ì„ ë°°ì›Œ
ë³´ì.

(ë°±ì—… ë°©ë²•)
â–  í’€ë°±ì—…(Full Backup) ë°©ë²• # cd /home
# tar -g /backup/2020-03-31.list -cvzf /backup/2020-03-31-full.tar.gz .  

â–  ì¦ë¶„ë°±ì—…(Incremental Backup) ë°©ë²• # cd /home
# tar -g /backup/2020-03-31.list -czvf /backup/2020-03-31.tar.gz .

(ë³µêµ¬ ë°©ë²•)
â–  í’€ë°±ì—…(Full Backup) ë³µêµ¬ë°©ë²• 
# cd /home
# tar -g /backup/2020-03-31.list â€“xzvf /backup/2020-03-31-tat.gz

â–  ì¦ë¶„ë°±ì—…(Incremental Backup) ë³µêµ¬ë°©ë²• 
# cd /home
# tar -g /backup/2020-03-31.list â€“xzvf /backup/2020-03-31.tar.gz 

â‘  tar ëª…ë ¹ì–´ë¥¼ ì‚¬ìš©í•œ í’€ ë°±ì—…(Full Backup) 
í…ŒìŠ¤íŠ¸í•  ë•Œ, ë°±ì—… ë°›ì„ íƒ€ì¼“ ë””ë ‰í† ë¦¬ëŠ” /home/user01 ë¡œ ì •í–ˆë‹¤. ì¢€ ì‘ì€ ë””ë ‰í† ë¦¬ë¥¼ ì„ ì •í–ˆë‹¤. 

# cd /home/user01
# cp -p /etc/passwd file1
# cp -p /etc/hosts  file2
# cp -p /etc/group  file3

# ls -al  í•´ë‹¹íŒŒì¼ì„ ì œì™¸í•˜ê³ ëŠ” ëª¨ë‘ ì‚­ì œí•œë‹¤.
total 16
drwx------. 2 user01 class1   60 Mar 31 16:17 .
drwxr-xr-x. 9 root   root     98 Mar 31 14:52 ..
-rw-r--r--. 1 user01 class1  231 Aug  8  2019 .bashrc
-rw-r--r--. 1 root   root   2596 Mar 31 14:52 file1
-rw-r--r--. 1 root   root    244 Mar 20 12:41 file2
-rw-r--r--. 1 root   root   1106 Mar 31 14:52 file3

# mkdir /backup
# cd /home/user01
# tar -g /backup/backup.list -cvzpf /backup/full_backup.tar.gz .
tar.gz .
tar: .: Directory is new
./
./.bashrc
./file1
./file2
./file3

# ls â€“l /backup
í•©ê³„ 8
-rw-r--r--. 1 root root  105  3ì›” 31 16:22 backup.list
-rw-r--r--. 1 root root 1956  3ì›” 31 16:22 full_backup.tar.gz
# tar tvzf /backup/full_backup.tar.gz 
drwx------ user01/class1    31 2020-03-31 16:17 ./
-rw-r--r-- user01/class1   231 2019-08-08 21:06 ./.bashrc
-rw-r--r-- root/root      2596 2020-03-31 14:52 ./file1
-rw-r--r-- root/root       244 2020-03-20 12:41 ./file2
-rw-r--r-- root/root      1106 2020-03-31 14:52 ./file3
# cat /backup/backup.list 
GNU tar-1.26-2
1585639334796125172015856390578745607132055262336.Y.bashrcYfile1Yfile2Yfile3#

â‘¡ tar ëª…ë ¹ì–´ë¥¼ ì‚¬ìš©í•œ ì¦ë¶„ ë°±ì—…(Incremental Backup)
# cp /etc/passwd file4
# tar -g /backup/backup.list -cvzpf /backup/incremental1.tar.gz .
./
./.bashrc
./file4
# ls -l /backup/
í•©ê³„ 12
-rw-r--r--. 1 root root  112  3ì›” 31 16:26 backup.list
-rw-r--r--. 1 root root 1956  3ì›” 31 16:22 full_backup.tar.gz
-rw-r--r--. 1 root root 1391  3ì›” 31 16:26 incremental1.tar.gz
# ls -lh /backup/
í•©ê³„ 12K
-rw-r--r--. 1 root root  112  3ì›” 31 16:26 backup.list
-rw-r--r--. 1 root root 2.0K  3ì›” 31 16:22 full_backup.tar.gz
-rw-r--r--. 1 root root 1.4K  3ì›” 31 16:26 incremental1.tar.gz
#
# cat /backup/backup.list 
GNU tar-1.26-2
1585639609730899683015856394964086172082055262336.Y.bashrcNfile1Nfile2Nfile3Yfile4#

â‘¤ tar ëª…ë ¹ì–´ë¥¼ ì‚¬ìš©í•œ ë³µêµ¬ ë°©ë²•
		(ê°€ì •) ë¶ˆì˜ì˜ ì‚¬ê³ ë¡œ /home/user01 í´ë”ì˜ ë‚´ìš©ì´ ì§€ì›Œì¡Œë‹¤ê³  ê°€ì •í•œë‹¤.
		# cd /home/user01
		# rm â€“rf *
# tar -g /backup/backup.list -xvzf /backup/full_backup.tar.gz -C /home/user01
./
./.bashrc
./file1
./file2
./file3
# cd /home/user01
# ls
file1  file2  file3
# ls -a
.  ..  .bashrc  file1  file2  file3

# tar -g /backup/backup.list -xvzf /backup/incremental1.tar.gz -C /home/user01
./
./.bashrc
./file4
# ls
file1  file2  file3  file4
# ls -al
í•©ê³„ 20
drwx------. 2 user01 class1   73  3ì›” 31 16:24 .
drwxr-xr-x. 9 root   root     98  3ì›” 31 14:52 ..
-rw-r--r--. 1 user01 class1  231  8ì›”  8  2019 .bashrc
-rw-r--r--. 1 root   root   2596  3ì›” 31 14:52 file1
-rw-r--r--. 1 root   root    244  3ì›” 20 12:41 file2
-rw-r--r--. 1 root   root   1106  3ì›” 31 14:52 file3
-rw-r--r--. 1 root   root   2596  3ì›” 31 16:24 file4

# ls /home/user01
file1  file2  file3  file4
```

[ì°¸ê³ ] ì›ê²© ì„œë²„ì— ë°±ì—…í•˜ëŠ” ê²½ìš°

```bash
------ ServerA ------                            ----- ServerB ------
# vi /etc/exports
/backup  ServerB(rw,no_root_squash)
# service nfs restart
# exportfs                                      # mount ServerA:/backup /backup
                                                # tar -g backup.list -cvzf /backup/backup.tar.gz /home
```

[ì°¸ê³ ] tar ëª…ë ¹ì–´ë¥¼ ì´ìš©í•œ í’€ë°±ì—… ë° ì¦ë¶„ ë°±ì—…ì— ëŒ€í•´ì„œ

```bash
â–  ì¶œì²˜: http://smiletw.myscan.org/myarticle/TarBackup.txt
=====================================================================================
ì œ 5íšŒ ë°ë¹„ì•ˆìœ ì €ìŠ¤ ì„¸ë¯¸ë‚˜ 
ë‚   ì§œ : 2002ë…„ 5ì›” 11ì¼
ì‘ì„±ì : ì—„íƒœìš±(smiletw)
=====================================================================================
(1) tar ëª…ë ¹ì–´ë¥¼ ì´ìš©í•œ í’€ë°±ì—… ë° ì¦ë¶„ ë°±ì—…

ì¼ë°˜ì ìœ¼ë¡œ tarë¥¼ ì´ìš©í•´ì„œ ì•„ì¹´ì´ë¸Œë¥¼ ë§Œë“¤ë©´ í’€ë°±ì—…ì´ ëœë‹¤. ê·¸ëŸ¬ë‚˜ ì‚¬ìš©ì í™ˆë””ë ‰í† ë¦¬ë˜ëŠ” í•œ íŒŒí‹°ì…˜ ì „ì²´ ë¥¼ ë°±ì—…í• ë•ŒëŠ” í’€ ë°±ì—…ì„ ìì£¼ ì‚¬ìš©í•˜ê¸° í˜ë“¤ë‹¤. ì´ëŸ´ê²½ìš° í’€ ë°±ì—…ê³¼í•¨ê»˜ ì¦ë¶„ ë°±ì—…ì„ í•´ ì£¼ëŠ” ê²ƒì´ ì¢‹ë‹¤. GNU 
tarëŠ” ì˜µì…˜ ì²˜ë¦¬ë§Œìœ¼ë¡œ ì†ì‰½ê²Œ í’€ë°±ì—…ê³¼ì¦ë¶„ ë°±ì—…ì´ ê°€ëŠ¥í•˜ê²Œ í•´ì¤€ë‹¤. 

ë¨¼ì €  GNU  tarì˜  í’€  ë°±ì—…  ë°  ì¦ë¶„  ë°±ì—…ì—  ì“°ì´ëŠ”  ì˜µì…˜ì´  2ê°€ì§€  ìˆë‹¤.
-G  (--incremental)ì˜µì…˜ê³¼  -g snapshot-file (--listed-incremental) ì´ ê·¸ê²ƒì´ë‹¤. 

-G ì˜µì…˜ì€ ì˜ˆì „ ì¦ë¶„ ë°±ì—… í¬ë§·ìœ¼ë¡œ ì•„ì¹´ì´ë¸Œë¥¼ ìƒì„±í•´ ì¤€ë‹¤. ì´ ì˜µì…˜ìœ¼ë¡œ ìƒì„±ëœì•„ì¹´ì´ë¸Œì—ëŠ” ì•„ì¹´ì´ë¸Œ ë‚´ì— í¬í•¨ë˜ì–´ ìˆëŠ” íŒŒì¼ì´ë‚˜ ë””ë ‰í† ë¦¬ì˜ ì •ë³´ê°€ ë“¤ì–´ê°€ë¯€ë¡œ ë¹„í‘œì¤€ ì•„ì¹´ì´ë¸Œë¡œ ìƒì„±ëœë‹¤. ë”°ë¼ì„œ GNUë²„ì ¼ì´ ì•„ë‹Œ tarë¡œë„ ë‚´ìš©ì„ ë³¼ ìˆ˜ê°€ ì—†ê²Œ ëœë‹¤. -g snapshot-file ì˜µ ì…˜ì€ í‘œì¤€ ì•„ì¹´ì´ë¸Œë¡œ ìƒì„±ë˜ë©´ì„œ, íŒŒì¼ì´ë‚˜ ë””ë ‰í† ë¦¬ ë“±ì˜ ì •ë³´ë¥¼ snapshot-fileì— ë”°ë¡œ ì €ì¥í•¨ìœ¼ë¡œì¨, í‘œì¤€ ì•„ì¹´ì´ë¸Œë¥¼ ìƒì„±í•˜ê²Œ ë§Œë“¤ì–´ ì¤€ë‹¤. ë”°ë¼ì„œ GNU tarë¥¼ ì´ìš©í•œ í’€ ë°±ì—… ë° ì¦ë¶„ ë°±ì—…ì—ì„œëŠ” -G ì˜µì…˜ì´ ì•„ë‹Œ -g snapshot-file ì˜µì…˜ì„ì‚¬ìš©í•˜ëŠ” ê²ƒì´ ì¢‹ë‹¤.

â–  í’€ ë°±ì—…(Full Backup)
$ tar -g list -czvf backup.tar.gz home/
list ë¼ëŠ” snap-shot íŒŒì¼ì´ ìƒì„±ëœë‹¤. ê·¸ë¦¬ê³  backup.tar.gzì´ë¼ëŠ” ë°±ì—…ëœì•„ì¹´ì´ë¸Œê°€ ìƒì„±ëœë‹¤.

â–  ì¦ë¶„ ë°±ì—…(Incremental Backup)
$ tar -g list -czvf backup-1.tar.gz home/
ê¸°ì¡´ì˜  list íŒŒì¼ì—ì„œ ì´ë¯¸ í’€ ë°±ì—…ëœ ë‚´ìš©ì„ í™•ì¸í•˜ê³ , ê·¸ ì´í›„ì— ë³€ê²½ë˜ê±°ë‚˜ ì¶”ê°€ë˜ê±°ë‚˜ì‚­ì œëœ íŒŒì¼ë“¤ì„ 
backup-1.tar.gzì— ë°±ì—…í•œë‹¤.

(2) GNU tarë¥¼ ì´ìš©í•œ ë³µêµ¬

ë¨¼ì € í’€ ë°±ì—…ëœ ì•„ì¹´ì´ë¸Œë¥¼ ë³µêµ¬í•œë‹¤.
$ tar -g list â€“xzvf backup.tar.gz

ë‹¤ìŒìœ¼ë¡œ ì¦ë¶„ ë°±ì—…ëœ ì•„ì¹´ì´ë¸Œë“¤ ì¤‘ ê°€ì¥ ìµœê·¼ì— ë°±ì—…í•œ ê²ƒë§Œ ë³µêµ¬í•˜ë©´ ëœë‹¤.
$ tar -g list â€“xzvf backup-10.tar.gz

(3) ë°±ì—… ë° ë³µêµ¬ì˜ ìœ ìš©í•œ ì˜µì…˜

-W (--verify) ê²€ì¦ ë°±ì—…ì„ í•˜ëŠ” ë„ì¤‘ ë³€ê²½ë˜ëŠ” íŒŒì¼ì´ ìˆì„ ê²½ìš°ê°€ ìˆë‹¤. íŠ¹íˆ í’€ ë°±ì—…ê³¼ ê°™ì´ ì‹œê°„ì´ ì˜¤ë˜ 
ê±¸ë¦¬ëŠ” ë°±ì—…ì˜ ê²½ìš° ì•„ì¹´ì´ë¸Œê°€ ìƒì„±ë˜ëŠ” ë™ì•ˆ ë³€ê²½ë  ê°€ëŠ¥ì„±ì´ ë†’ë‹¤. ë”°ë¼ì„œ í’€ ë°±ì—…ì˜ ê²½ìš° ê²€ì¦í•´ì£¼ëŠ” ê²ƒì´ 
ì¢‹ë‹¤.
$ tar -g list -cvf backup.tar home/
ì´ ê²½ìš° ì•„ì¹´ì´ë¸Œ ìƒì„± í›„, ì•„ì¹´ì´ë¸Œì˜ ë‚´ìš©ê³¼ ì‹¤ì œ ë””ë ‰í† ë¦¬ì˜ ë‚´ìš©ê³¼ ê°™ì€ì§€ í™•ì¸í•œë‹¤.ê·¸ëŸ¬ë‚˜ gzipìœ¼ë¡œ ì••ì¶• í•˜ëŠ” -z ì˜µì…˜ê³¼ ê°™ì´ ì‚¬ìš©í•  ìˆ˜ ì—†ë‹¤. ë”°ë¼ì„œ ê²€ì¦ ì˜µì…˜ì„ ì‚¬ìš©í•´ì„œì•„ì¹´ì´ë¸Œë¥¼ ìƒì„±í•  ê²½ìš° gzipì••ì¶•ì€ ë”°ë¡œ 
í•´ì£¼ì–´ì•¼ í•œë‹¤.

(4) ë°±ì—… ì •ì±…

GNU tarì˜ ê²½ìš° ì•ì„œ ë§í•œ level 1 ë°±ì—…ê¹Œì§€ë§Œì„ ì§€ì›í•´ ì¤€ë‹¤. snapshot-fileì´ ì—†ì„ê²½ìš° í’€ ë°±ì—…(level 0)ì„ 
í•˜ê³ , snapshot-fileì´ ì´ë¯¸ ì¡´ì¬í•  ê²½ìš° ì¦ë¶„ ë°±ì—…(level 1)ì„í•˜ê²Œ ëœë‹¤. ë”°ë¼ì„œ ì–´ëŠ ì‹œì ì— í’€ ë°±ì—…ì„ í•´ì•¼ 
í•˜ëŠ”ì§€ê°€ ë°±ì—… ì •ì±…ì—ì„œ ì¤‘ìš”í•˜ë‹¤.ë°±ì—…í•  íŒŒì¼ë“¤ì´ ìì£¼ ë³€ê²½ë  ê²½ìš°, í’€ ë°±ì—…ì˜ ì£¼ê¸°ë„ ì§§ì•„ì§„ë‹¤. ë˜í•œ ë³€í™” ë  ë°ì´í„°ê°€ë§¤ìš° ì¤‘ìš”í•  ê²½ìš°, ë°±ì—…ë„ ìì£¼ í•´ì•¼í•œë‹¤.

ì¼ë°˜ì ìœ¼ë¡œ level 1 ë°±ì—…ë§Œì„ ì§€ì›í•´ ì£¼ëŠ” GNU tarë¥¼ ì´ìš©í•œë‹¤ë©´, 1ì£¼ì¼ì— í•œë²ˆ í’€ ë°±ì—…ì„ ì‹¤í–‰í•˜ê³  ë§¤ì¼ ì¦ë¶„ 
ë°±ì—…ì„ í•œë‹¤. ë°±ì—…í•˜ëŠ” ì‹œê°„ì€ íŒŒì¼ì˜ ë³€í™”ê°€ ì ì€ ìƒˆë²½ì´ ì¢‹ë‹¤.ë”°ë¼ì„œ ì¼ìš”ì¼ ìƒˆë²½12ì‹œë¥¼ ì „ í›„í•´ì„œ í’€ ë°±ì—… ì„ í•˜ê³ , ë§¤ì¼ ìƒˆë²½ì— ì¦ë¶„ ë°±ì—…ì„ í•˜ëŠ” ê²ƒì´ì¢‹ë‹¤.

ë˜í•œ í’€ ë°±ì—…ì˜ ê²½ìš°, ê²€ì¦ ì˜µì…˜ (-W)ì„ ì‚¬ìš©í•˜ì—¬, ì•„ì¹´ì´ë¸Œë¥¼ ê²€ì¦í•´ì£¼ëŠ” ê²ƒì´ ì¢‹ë‹¤.ê·¸ë¦¬ê³  ì•„ì¹´ì´ë¸Œì˜ í¬ê¸° ë¥¼ ì¤„ì´ê¸° ìœ„í•´ì„œ -z ì˜µì…˜ì„ ì‚¬ìš©í•˜ì—¬ ì••ì¶•í•´ ì£¼ëŠ” ê²ƒì´ ì¢‹ë‹¤. ì•„ì¹´ì´ë¸Œë¥¼ ë§Œë“¤ ë•ŒëŠ” ì•„ì¹´ì´ë¸Œì˜ ì´ë¦„ì— ì‹ ê²½ ì„ ì¨ì£¼ì–´ì•¼ ë°±ì—…ì„ í•  ë•Œ, í˜¼ë€ì´ ì ë‹¤.í’€ ë°±ì—…ì„ í•  ê²½ìš° ë‹¤ìŒê³¼ ê°™ì´ snapshot-fileì˜ ì´ë¦„ë„ ë°±ì—… ë‚ ì§œë¥¼ 
ì¨ì£¼ëŠ” ê²ƒì´ ì¢‹ë‹¤.
$ tar -g 2002-05-11.list -W -cvf 2002-05-11-full.tar home/

ì¦ë¶„ë°±ì—… ë•Œë„ ë§ˆì°¬ê°€ì§€ë¡œ ë‚ ì§œë¥¼ ì¨ ì£¼ëŠ” ê²ƒì´ ì¢‹ë‹¤.
$ tar -g 2002-05-11.list -czvf 2002-05-12.tar.gz home/

ê·¸ë¦¬ê³  -g ì˜µì…˜ì— ì“°ì´ëŠ” snapshot-fileì˜ ë³´ê´€ ë˜í•œ ì¤‘ìš”í•˜ë‹¤. snapshot-fileì´ ì—†ìœ¼ë©´ ì¦ë¶„ ë°±ì—…ëœ ì•„ì¹´ì´ë¸Œ ëŠ” ìˆ˜ì •ëœ ë¶€ë¶„ë§Œ ì €ì¥ë˜ì–´ ìˆëŠ” ì¼ë°˜ ì•„ì¹´ì´ë¸Œì™€ ê°™ì•„ì§„ë‹¤. ì¦‰, í’€ ë°±ì—… ì´í›„ ì‚­ì œëœ íŒŒì¼ì´ ìˆìŒì—ë„ ë¶ˆêµ¬í•˜ ê³ , ì¦ë¶„ ë°±ì—…ëœ ì•„ì¹´ì´ë¸Œë¥¼ ë³µêµ¬í•  ë•Œ,í’€ ë°±ì—…ëœ ì•„ì¹´ì´ë¸Œì˜ ë³µêµ¬ë•Œ ìƒì„±ëœ íŒŒì¼ì´ ì‚­ì œë˜ì§€ ì•ŠëŠ”ë‹¤. ë”°ë¼ì„œ 
ìš©ëŸ‰ì´ ì‘ì€snapshot-fileì€ ê¼­ ë”°ë¡œ ì•ˆì „í•œ ê³³ì— ë³´ê´€í•´ ì£¼ì–´ì•¼ í•œë‹¤.
```

[EX2] tar ëª…ë ¹ì–´ë¥¼ ì´ìš©í•œ íŠ¹ì • ë””ë ‰í† ë¦¬ ë°ì´í„° ìë™ ë°±ì—…

ìë™í™” ì‘ì—…ì€ ë°±ì—…í•  ë•Œ ë§ì€ ë„ì›€ì„ ì£¼ëŠ”ë°, ì•„ë˜ì—ì„œëŠ” ìë™ìœ¼ë¡œ ë°±ì—…í•˜ê¸° ìœ„í•´ì„œ backup.cronì´ë¼ëŠ” ìŠ¤í¬ë¦½íŠ¸ ë¥¼ ì˜ˆë¥¼ë“¤ì–´ ì„¤ëª…í•˜ê³  ìˆë‹¤. ì´ ë°±ì—… ìŠ¤í¬ë¦½íŠ¸ëŠ” ëª‡ ê°€ì§€ ë³€ìˆ˜(COMPUTER, DIRECTORIES, BACKUPDIR ê·¸ë¦¬ê³  TIMEDIR)ë§Œ ë³€ê²½í•´ ì£¼ë©´ ì–´ë– í•œ í™˜ê²½ì—ì„œë„ ì‚¬ìš©í•  ìˆ˜ ìˆë‹¤. ì´ ìŠ¤í¬ë¦½íŠ¸ë¥¼ ì´ìš©í•´ ì²« ë‹¬ ì´ˆì— ì‹¤í–‰í•˜ê³  ì£¼ëœ ë³€ê²½ ì´ ìˆê¸° ì „ì— í•œ ë‹¬ ë™ì•ˆ ì‹¤í–‰í•œë‹¤. ì´ ì˜ˆì œì—ì„œëŠ” ë¡œì»¬ ì„œë²„ì˜(BACKUPDIR) ë””ë ‰í† ë¦¬ë¡œ ë°±ì—…ì„ í•˜ëŠ”ë° ë¬¼ë¡  ì´ ìŠ¤ í¬ë¦½íŠ¸ë¥¼ ìˆ˜ì •í•˜ì—¬ ë¡œì»¬ ì„œë²„ì— ìˆëŠ” í…Œì´í”„ë‚˜ nfsë¥¼ í†µí•œ ë°±ì—…ë„ í•  ìˆ˜ ìˆë‹¤.

```bash
â‘  touch /etc/cron.daily/backup.cron ìƒì„± 
# mkdir /backups  /* ë°±ì—…ì„ ì €ì¥í•  ìœ„ì¹˜ */
# mkdir /backups/last-full  /* í’€ ë°±ì—…í•œ ì‹œê°ì„ ì €ì¥í•  íŒŒì¼ */
# touch /etc/cron.daily/backup.cron
# vi /etc/cron.daily/backup.cron

#!/bin/bash
#
# ê°ìì˜ í™˜ê²½ì— ë§ë„ë¡ ì•„ë˜ 5ê°œì˜ ë³€ìˆ˜ë¥¼ ìˆ˜ì •í•œë‹¤.
COMPUTER=wuddl  # ì´ ì»´í“¨í„°ì˜ ì´ë¦„ 
DIRECTORIES=/home  # ë°±ì—…í•  ë””ë ‰í† ë¦¬ 
BACKUPDIR=/backups  # ë°±ì—…ì„ ì €ì¥í•  ìœ„ì¹˜ 
TIMEDIR=/backups/last-full# í’€ ë°±ì—…í•œ ì‹œê°ì„ ì €ì¥í•  íŒŒì¼ 
TAR=/bin/tar  # tar ëª…ë ¹ì˜ ìœ„ì¹˜

#ì•„ë˜ëŠ” ì „í˜€ ë³€ê²½í•  í•„ìš”ê°€ ì—†ë‹¤.
PATH=/usr/local/bin:/usr/bin:/bin
DOW=`date +%a`  # ì¼ì£¼ì¼ ì¤‘ì˜ ìš”ì¼. ì˜ˆë¥¼ ë“¤ë©´ Mon
DOM=`date +%d`  # í•œ ë‹¬(31ì¼) ì¤‘ì˜ ë‚ ì§œ. ì˜ˆë¥¼ ë“¤ë©´ 27
DM=`date +%d%b`  # ë‚ ì§œì™€ ë‹¬. ì˜ˆë¥¼ ë“¤ë©´ 27Sep

# í•œ ë‹¬ì˜ ì²«ë‚ (1ì¼)ì— ì˜ì›í•œ í’€ ë°±ì—…ì´ ì§„í–‰ëœë‹¤.
# ë§¤ ì¼ìš”ì¼ì—ëŠ” ì§€ë‚œ ì¼ìš”ì¼ì˜ ë°±ì—…ì„ ë®ì–´ì“°ëŠ” í’€ ë°±ì—…ì´ ì§„í–‰ëœë‹¤.
# ë‚˜ë¨¸ì§€ ì‹œê°„ì—ëŠ” ì¦ê°€ë¶„ ë°±ì—…ì´ ì§„í–‰ë˜ëŠ”ë°,
# ê°ê°ì˜ ì¦ê°€ë¶„ ë°±ì—…ì€ ê°™ì€ ì´ë¦„ìœ¼ë¡œ ì¼ì£¼ì¼ ì „ì˜ ì¦ê°€ë¶„ ë°±ì—…ì„ ë®ì–´ì“´ë‹¤.
#
# ë§Œì•½ NEWER = ""ì¼ ê²½ìš° tarëŠ” ë””ë ‰í† ë¦¬ì— ìˆëŠ” ëª¨ë“  íŒŒì¼ì„ ë°±ì—…í•˜ê³  
# NEWERì˜ ë‚ ì§œëŠ” ë§¤ì£¼ ì¼ìš”ì¼ì— ì“°ì—¬ì§€ëŠ” íŒŒì¼ì—ì„œ ì½ì–´ì˜¨ë‹¤.
#

# ë§¤ë‹¬ í’€ ë°±ì—… if( $DOM = "01" ]; then            # í•œë‹¬ì¤‘ 01ì´ë©´ 
NEWER=""
$TAR $NEWER -cf $BACKUPDIR/$COMPUTER-$DM.tar $DIRECTORIES
# tar "" -cf /backups/wuddl-`date +%d%b`.tar /homeì˜ ëª…ë ¹ì–´ê°€ ì‹¤í–‰ë˜ëŠ” ê²ƒê³¼ ë™ì¼ 
fi

# ë§¤ì£¼ë³„ í’€ ë°±ì—… 
if [ $DOW = "Sun" ]; then
NEWER=""
NOW=`date +%d-%b`

# í’€ ë°±ì—… ë‚ ì§œë¥¼ ê°±ì‹ í•œë‹¤.
echo $NOW > $TIMEDIR/$COMPUTER-full-date
# echo `date +%d-%b`> /backups/last-full/wuddl-full-dateì˜ ëª…ë ¹ì–´ê°€ ì‹¤í–‰ë˜ëŠ” ê²ƒê³¼ ë™ì¼ 
$TAR $NEWER -cf $BACKUPDIR/$COMPUTER-$DOW.tar $DIRECTORIES
# tar "" -cf /backups/wuddl-`date +%d%b`.tar /homeì˜ ëª…ë ¹ì–´ê°€ ì‹¤í–‰ë˜ëŠ” ê²ƒê³¼ ë™ì¼ 
# ì¦ê°€ë¶„ ë°±ì—…ì„ í•œë‹¤. ì§€ë‚œ ì£¼ì˜ ë°ì´í„°ë¥¼ ë®ì–´ì“´ë‹¤.
else

# ì§€ë‚œ í’€ë°±ì—…ì˜ ë‚ ì§œë¥¼ ê°€ì ¸ì˜¨ë‹¤.
NEWER="--newer `cat $TIMEDIR/$COMPUTER-full-date`"
$TAR$NEWER -cf $BACKUPDIR/$COMPUTER-$DOW.tar $DIRECTORIES
fi
```

```bash
â‘¡ TIMEDIR ë””ë ‰í† ë¦¬ì— ì‹œê°„ì„ ë‚˜íƒ€ë‚´ëŠ” íŒŒì¼ì„ ìƒì„± 
# date +%d%b > /backups/last-full/myserver-full-date
/* '/backups/last-full'ì€ TIMEDIR ë³€ìˆ˜ë¡œì„œ í’€ ë°±ì—…ì„ í•œ ì‹œê°„ì„ ì €ì¥ */
/* 'myserver-full-date'ì€ ì„œë²„ì˜ ì´ë¦„ */

â‘¢ root ê¶Œí•œë§Œì´ ìŠ¤í¬ë¦½íŠ¸ë¥¼ ì‹¤í–‰ ê°€ëŠ¥í•˜ë„ë¡ ê¶Œí•œ ë³€ê²½ 
# chmod 700 /etc/cron.daily/backup.cron
/* /etc/cron.daily ë””ë ‰í† ë¦¬ì— ìˆìœ¼ë¯€ë¡œ cronì— ì˜í•´ ë§¤ì¼ ì˜¤ì „ 1ì‹œì— ìë™ìœ¼ë¡œ ì‹¤í–‰ */
```

### [EX3] tar ëª…ë ¹ì–´ë¥¼ í†µí•œ ë°ì´í„° ë§ˆì´ê·¸ë ˆì´ì…˜

```bash
ë§ì€ ë°ì´í„°ê°€ ë“¤ì–´ ìˆëŠ” ë””ë ‰í† ë¦¬ë¥¼ ë‹¤ë¥¸ ë””ë ‰í† ë¦¬ë¡œ ë§ˆì´ê·¸ë ˆì´ì…˜ ì‘ì—…ì„ í•˜ê¸° ìœ„í•´ì„œëŠ” cp ëª…ë ¹ì–´ë¥¼ ì‚¬ìš©í•˜ ì§€ ì•Šê³ , ë°±ì—…í•˜ëŠ” ëª…ë ¹ì–´ë¥¼ í†µí•´ì„œ ì˜®ê¸´ë‹¤.

(cp ëª…ë ¹ì–´ë¥¼ í†µí•œ ë””ë ‰í† ë¦¬ ë³µì‚¬)
# mkdir /test1 /test2
# cd /test1
# cp /etc/passwd file1
# ln -s file1 file2
# cp /bin/ls file3
# cp ~/.bashrc .file4
# mkdir dir1

# cp -r /test1/* /test2
# ls -al /test1 /test2
/test1:
total 124
drwxr-xr-x  3 root root  4096 Mar  3 04:01 .
drwxr-xr-x 32 root root  4096 Mar  3 04:01 ..
-rw-r--r--  1 root root   289 Mar  3 04:01 .file4
drwxr-xr-x  2 root root  4096 Mar  3 04:01 dir1
-rw-r--r--  1 root root  2027 Mar  3 04:01 file1
lrwxrwxrwx  1 root root     5 Mar  3 04:01 file2 -> file1
-rwxr-xr-x  1 root root 95116 Mar  3 04:01 file3
/test2:
total 120
drwxr-xr-x  3 root root  4096 Mar  3 04:02 .
drwxr-xr-x 32 root root  4096 Mar  3 04:01 ..
drwxr-xr-x  2 root root  4096 Mar  3 04:02 dir1
-rw-r--r--  1 root root  2027 Mar  3 04:02 file1
lrwxrwxrwx  1 root root     5 Mar  3 04:02 file2 -> file1
-rwxr-xr-x  1 root root 95116 Mar  3 04:02 file3

(tar ëª…ë ¹ì–´ë¥¼ í†µí•œ ë””ë ‰í† ë¦¬ ë³µì‚¬)
# rm -rf /test1 /test2

# mkdir /test1 /test2
# cd /test1
# cp /etc/passwd file1
# ln -s file1 file2
# cp /bin/ls file3
# cp ~/.bashrc .file4
# mkdir dir1

# cd /test1
# tar cvpf - . | (cd /test2 ; tar xvpf -)
# ls -al /test1 /test2
/test1:
total 124
drwxr-xr-x  3 root root  4096 Mar  3 04:01 .
drwxr-xr-x 32 root root  4096 Mar  3 04:01 ..
-rw-r--r--  1 root root   289 Mar  3 04:01 .file4
drwxr-xr-x  2 root root  4096 Mar  3 04:01 dir1
-rw-r--r--  1 root root  2027 Mar  3 04:01 file1
lrwxrwxrwx  1 root root     5 Mar  3 04:01 file2 -> file1
-rwxr-xr-x  1 root root 95116 Mar  3 04:01 file3
/test2:
total 124
drwxr-xr-x  3 root root  4096 Mar  3 04:01 .
drwxr-xr-x 32 root root  4096 Mar  3 04:01 ..
-rw-r--r--  1 root root   289 Mar  3 04:01 .file4
drwxr-xr-x  2 root root  4096 Mar  3 04:01 dir1
-rw-r--r--  1 root root  2027 Mar  3 04:01 file1
lrwxrwxrwx  1 root root     5 Mar  3 04:06 file2 -> file1
-rwxr-xr-x  1 root root 95116 Mar  3 04:01 file3
```

### [EX4] tar ëª…ë ¹ì–´ë¥¼ ì´ìš©í•œ ìš´ì˜ì²´ì œ ì „ì²´ ë°±ì—…

```bash
ìš´ì˜ì²´ì œë¥¼ ë°±ì—…í•˜ê¸° ìœ„í•´ì„œ /proc, /mnt, /media, tmp ë””ë ‰í† ë¦¬ëŠ” í¬í•¨í•˜ì§€ ì•Šì•„ë„ ëœë‹¤. ì œì™¸í•  ë””ë ‰í† ë¦¬ì˜ 
ê²½ìš° '--exclude='ë¡œ ì˜ì—­ì„ ì§€ì •í•´ì¤€ë‹¤. ì§€ì •ëœ ì˜ì—­ì„ ì œì™¸í•œ ë‚˜ë¨¸ì§€ ë¶€ë¶„ì´ '<ë°±ì—…íŒŒì¼ëª…>.tar.gz'ìœ¼ë¡œ 
ë°±ì—…ë˜ëŠ” ê²ƒì´ë‹¤. 

(ëª…ë ¹ì–´ í˜•ì‹)
   # tar cvzpf /backup<ë°±ì—…íŒŒì¼ëª…>.tar.gz --exclude=<ì œì™¸í•  ë””ë ‰í† ë¦¬> --absolute-name /
# du â€“sh /
3.6G    /
# df â€“h
Filesystem            Size  Used Avail Use% Mounted on
/dev/sda1             6.4G  3.4G  2.7G  56% /
/dev/sda8             487M   11M  451M   3% /data1
/dev/sda7             487M   11M  451M   3% /data2
/dev/sda6             487M   11M  451M   3% /data3
/dev/sda5             487M   11M  451M   3% /data4
/dev/sda3             487M   11M  451M   3% /home
tmpfs                 506M     0  506M   0% /dev/shm
/dev/sdc1             7.9G  147M  7.4G   2% /RootBackup

time tar cvzfp /backup/systemFULLbackup.tar.gz --exclude=/backup --exclude=/mnt --exclude=/project --exclude=/sys --exclude=/tmp --exclude=/share --exclude=/system --exclude=/media --exclude=/proc --exclude=/run --exclude=/srv --exclude=/test --exclude=/var --exclude=/home --exclude=/boot --absolute-name /

..... (ì¤‘ëµ) .....
/dev/pts/
/dev/pts/1
/boot/
/boot/grub/
/boot/grub/device.map
/boot/grub/vstafs_stage1_5
..... (ì¤‘ëµ) ......
real	1m35.603s
user	0m38.857s
sys	  0m23.718s

# ls -lh systemFULLbackup.tar.gz 
-rw-r--r--. 1 root root 559M Dec 29 15:52 systemFULLbackup.tar.gz

#  df  -h
Filesystem            Size  Used Avail Use% Mounted on
/dev/sda1             6.4G  3.4G  2.7G  56% /
/dev/sda8             487M   11M  451M   3% /data1
/dev/sda7             487M   11M  451M   3% /data2
/dev/sda6             487M   11M  451M   3% /data3
/dev/sda5             487M   11M  451M   3% /data4
/dev/sda3             487M   11M  451M   3% /home
tmpfs                 506M     0  506M   0% /dev/shm
/dev/sdc1             7.9G  1.3G  6.3G  17% /RootBackup
```

## rsync ì„œë¹„ìŠ¤ë¥¼ ì´ìš©í•œ ë°±ì—…

(1) rsync ì„œë¹„ìŠ¤ë¥¼ ì´ìš©í•œ ë¡œì»¬ ë°ì´í„° ë°±ì—… ë° ì„œë²„ ë™ê¸°í™”

- ì—¬ëŸ¬ ëŒ€ì˜ ì„œë²„ë¥¼ ë¶„ì‚°í•˜ì—¬ ì„œë²„ ë°ì´í„°ë¥¼ ë™ê¸°í™”í•˜ëŠ”ë° rsync ìœ í‹¸ë¦¬í‹°ê°€ ë§ì´ ì‚¬ìš©ëœë‹¤. rsyncëŠ” ë£¨íŠ¸ ê¶Œí•œì—† ì´ ì„œë²„ë¡œë¶€í„° ë°ì´í„°ë¡œ ë¹ ë¥´ê²Œ ì „ì†¡ë°›ì„ ìˆ˜ ìˆìœ¼ë©°, ì›ê²© ì„œë²„ì™€ ë¯¸ëŸ¬ ì„œë²„ì™€ ì „ì†¡ ë°ì´í„°ë¥¼ ë¹„êµí•˜ì—¬ ë³€í™”ëœë°ì´í„°ë¥¼ ì €ì¥í•  ìˆ˜ ìˆë‹¤. ë˜í•œ SSHë¥¼ ì´ìš©í•˜ë©´ rsync ì„œë²„ê°€ êµ¬ì¶•ë˜ì–´ ìˆì§€ ì•Šì•„ë„ ë¯¸ëŸ¬ë§ì„ í•  ìˆ˜ ìˆëŠ” ì´ì  ì´ ìˆë‹¤.
- rsync ì„œë²„ëŠ” systemd ë°©ì‹ìœ¼ë¡œ ë™ì‘í•œë‹¤.

```bash
----- ServerA ----- ----- ServerB -----
rsync --daemon(873)          
/etc/rsyncd.conf 
/Mirror_Backup   <------------------>    /Backup
                                          # rsync -avz --delete -e ssh ServerA:/Mirror_Backup /Backup
```

(a) rsync ì„œë²„ ì„¤ì • ê³¼ì •

(ã„±) /etc/rsyncd.conf ìƒì„±

(ã„´) /etc/xinetd.d/rsync ìˆ˜ì •

(ã„·) xinetd ì„œë¹„ìŠ¤ ì¬ì‹œì‘

(b) rsync í´ë¼ì´ì–¸íŠ¸

(ã„±) rsync ëª…ë ¹ì–´ë¥¼ ì´ìš©í•œë‹¤.

(2) rsync ëª…ë ¹ì–´

[ëª…ë ¹ì–´ í˜•ì‹]

```bash
# rsync -avz --delete -e ssh <ì›ê²©ì„œë²„:ë°ì´í„°ê²½ë¡œ> <ë°±ì—…ê²½ë¡œ> 
# rsync -avz --delete -e ssh 192.168.0.250:/backup /backup
Options
 -a, --archive               archive mode; same as -rlptgoD (no -H)
 -v, --verbose               increase verbosity
 -z, --compress              compress file data during the transfer
     --delete                delete files that don't exist on the sending side
 -r, --recursive             recurse into directories
 -I, --ignore-times          don't skip files that match in size and mod-time
 -p, --perms                 preserve permissions
 -o, --owner                 preserve owner (super-user only)
 -g, --group                 preserve group
 -t, --times                 preserve times
 -D                          same as --devices --specials
```

### [EX1] ë¡œì»¬ì„œë²„ì˜ ë¡œì»¬ ë””ë ‰í† ë¦¬ì™€ ë¡œì»¬ ë””ë ‰í† ë¦¬ ë™ê¸°í™”

[ëª…ë ¹ì–´ í˜•ì‹]

```bash
# rsync -avz --delete -e ssh /backup/ /test101/
# rsync -avz --delete -e ssh /backup/ /test101

# rsync -avz --delete -e ssh /backup  /test101

# rsync -avz --delete -e ssh IP:/backup/ /test100/
# rsync -avz --delete -e ssh IP:/backup/ /test100

# rsync -avz --delete -e ssh IP:/backup /test100
```

```bash
ë§Œì•½ rsync í”„ë¡œê·¸ë¨ì´ ì„¤ì¹˜ë˜ì–´ ìˆì§€ ì•Šë‹¤ë©´ í”„ë¡œê·¸ë¨ì„ ì„¤ì¹˜í•´ ì¤€ë‹¤.

# rpm â€“q rsync
# yum install rsync 

â‘  ë°±ì—… ë””ë ‰í† ë¦¬ í™•ì¸ 
ë§Œì•½ /backup ë””ë ‰í† ë¦¬ì•ˆì— ë‚´ìš©ì´ ì—†ë‹¤ë©´ ë§Œë“¤ì–´ ì¤€ë‹¤.
# mkdir /backup
# cd /backup/
# ls
# cp /boot/vmlinuz-3.10.0-1062.el7.x86_64 file1
# cp -r /var .
# cp -r /etc .
# ls
# tar cvzf var.tar.gz var
# ls
# tar cvzf etc.tar.gz etc
# ls 
etc  etc.tar.gz  file1  var  var.tar.gz

â‘¡ /backup(ì›ë³¸) ë””ë ‰í† ë¦¬ì™€ /test100/backup(ë¯¸ëŸ¬) ë””ë ‰í† ë¦¬ë¥¼ ë™ê¸°í™”
# mkdir /test100
# rsync -avz --delete -e ssh 192.168.10.200:/backup /test100  (192.168.10.200 : ìì‹ ì˜ ì„œë²„ì˜ IP)
The authenticity of host 192.168.10.200 (192.168.10.200) can not be established.
ECDSA key fingerprint is SHA256:nTnwdxm0q7GvePDQQ/RX1ABClExOUrJ13OXbIOIfGgI.
ECDSA key fingerprint is MD5:a1:30:58:a1:db:a2:55:48:cb:b8:a6:0a:b2:19:8c:ce.
Are you sure you want to continue connecting (yes/no)? yes
Warning: Permanently added '192.168.10.200' (ECDSA) to the list of known hosts.
root@192.168.10.200 is password:
# ls /test100
backup
# ls /backup /test100/backup
/backup:
etc  etc.tar.gz  file1  var  var.tar.gz

/test100/backup:
etc  etc.tar.gz  file1  var  var.tar.gz

â‘¢ /backup ë””ë ‰í† ë¦¬ì—ì„œ var ë””ë ‰í† ë¦¬íŒŒì¼ ì‚­ì œ 
# rm -rf /backup/var
# ls
etc  etc.tar.gz  file1  var.tar.gz

â‘£ /backup(ì›ë³¸) ë””ë ‰í† ë¦¬ì™€ /test100/backup(ë¯¸ëŸ¬) ë””ë ‰í† ë¦¬ë¥¼ ë™ê¸°í™” 
# rsync -avz --delete -e ssh 192.168.10.200:/backup /test100 
rsync -avz --delete -e ssh 192.168.10.200:/backup /test100
root@192.168.10.200 is password:

# ls /backup /test100/backup
/backup:
etc  etc.tar.gz  file1  var.tar.gz

/test100/backup:
etc  etc.tar.gz  file1  var.tar.gz
```

```bash
(ì£¼ì˜) ì•„ë˜ ì‚¬í•­ì˜ ì°¨ì´ì ì„ ì´í•´ í•´ì•¼ í•œë‹¤.
# rsync -avz --delete -e ssh /backup/ /test101/  (# rsync -avz --delete -e ssh /backup/ /test101)
-> (ã„±) /test101 ë””ë ‰í† ë¦¬ê°€ ì—†ìœ¼ë©´ ìƒì„±ëœë‹¤.
-> (ã„´) /backup ë””ë ‰í† ë¦¬ì˜ ë‚´ìš©ê³¼ /test101 ë””ë ‰í† ë¦¬ì˜ ë‚´ìš©ì€ ë™ì¼í•˜ë‹¤.

# rsync -avz --delete -e ssh /backup /test101
-> (ã„±) /test101 ë””ë ‰í† ë¦¬ê°€ ì—†ìœ¼ë©´ ìƒì„±ëœë‹¤.
-> (ã„´) /test101 ë””ë ‰í† ë¦¬ì•ˆì— backup ë””ë ‰í† ë¦¬ê°€ ìƒì„±ëœë‹¤.
```

### [EX2] rsync ì„œë²„ êµ¬ì¶• ë° rsync ëª…ë ¹ì–´ ì‚¬ìš©  â†’

- sshë¥¼ ì´ìš©í•œ rsyncë°ì´í„° ë™ê¸°í™”ë¥¼ ìœ„í•´ì„œëŠ” ì„œë²„ì— sshì„œë²„ê°€ ì‘ë™ í•˜ê³  ìˆì–´ì•¼ í•œë‹¤.
- rsync ì„œë²„ë¥¼ êµ¬ì¶•í•˜ê¸° ìœ„í•´ì„œëŠ” rsync ì„¤ì •íŒŒì¼ì¸ /etc/rsyncd.conf íŒŒì¼ì„ ì„¤ì •í•´ì•¼ í•œë‹¤.

(a) rsync ì„œë²„ ì„¤ì • ê³¼ì •

(ã„±) /etc/rsyncd.conf ìƒì„±

(ã„´) systemctl ì„œë¹„ìŠ¤ ì¬ì‹œì§

(b) rsync í´ë¼ì´ì–¸íŠ¸

(ã„±) rsync ëª…ë ¹ì–´ë¥¼ ì´ìš©í•œë‹¤.

```bash
[SERVER2ì—ì„œ ì‘ì—…]

â‘  /etc/rsyncd.conf íŒŒì¼ ì‘ì„± 

# rpm -q rsync       (# rpm -qa | grep rsync)
rsync-3.1.2-6.el7_6.1.x86_64

		# rpm -q rsync
		# rpm -qi rsync
		# rpm -ql rsync
		# rpm â€“qf /bin/ls
# rpm â€“ql rsync
/etc/rsyncd.conf
/etc/sysconfig/rsyncd
/usr/bin/rsync
/usr/lib/systemd/system/rsyncd.service
/usr/lib/systemd/system/rsyncd.socket
/usr/lib/systemd/system/rsyncd@.service
# man rsyncd.conf
/EXAMPLES           <----- ë§¤ë‰´ì–¼ í˜ì´ì§€ì—ì„œ ë¹ ë¥¸ ê²€ìƒ‰ì„ í•œë‹¤.
..... (ì¤‘ëµ) .....
uid = nobody
gid = nobody
use chroot = no
max connections = 4
syslog facility = local5
pid file = /var/run/rsyncd.pid
[ftp]
        path = /var/ftp/pub
        comment = whole ftp area (approx 6.1 GB)
[sambaftp]
        path = /var/ftp/pub/samba
        comment = Samba ftp area (approx 300 MB)
[rsyncftp]
        path = /var/ftp/pub/rsync
        comment = rsync ftp area (approx 6 MB)
[sambawww]
        path = /public_html/samba
        comment = Samba WWW pages (approx 240 MB)

[cvs]
        path = /data/cvs
        comment = CVS repository (requires authentication)
        auth users = tridge, susan
        secrets file = /etc/rsyncd.secrets
       The /etc/rsyncd.secrets file would look something like this:
              tridge:mypass
              susan:herpass
..... (ì¤‘ëµ) .....
# vi /etc/rsyncd.conf       (# scp 192.168.0.250:/etc/rsyncd.conf /etc/rsyncd.conf)
uid=nobody                  /* ì‚¬ìš©ì ì•„ì´ë”” */
gid=nobody                  /* ê·¸ë£¹ ì•„ì´ë”” */
use chroot=no               /* yes : ì§€ì •ëœ ê²½ë¡œ ì´ì™¸ì— ë‹¤ë¥¸ ê²½ë¡œë¡œ ì ‘ì† ëª»í•˜ê²Œ í•¨ */ 
max connections=5           /* ìµœëŒ€ ì ‘ì†ì ìˆ˜ : 0ì€ ë¬´ì œí•œì„ ë‚˜íƒ€ëƒ„ */
timeout=60                  /* Clientì˜ ì ‘ì†ì´ idleìƒíƒœì¼ ë•Œ ì ‘ì†ì„ ëŠì–´ë²„ë¦´ ì´ˆ ë‹¨ìœ„ ì‹œê°„ */ 
[Backup]                    /* rsync ì„œë¹„ìŠ¤ëª… */
comment=Rsync Backup Server /* rsync ì„œë¹„ìŠ¤ì— ëŒ€í•œ ì„¤ëª… */
path=/backup1               /* ë¯¸ëŸ¬ë§ë  ë°ì´í„°ì˜ ê²½ë¡œ (ëŒ€ìƒíŒŒì¼ê²½ë¡œ) */
read only=no                /* yes : ë‹¤ìš´ë¡œë“œ ê°€ëŠ¥ / no : ì—…ë¡œë“œ ê°€ëŠ¥ */

(/etc/rsyncd.conf íŒŒì¼ì˜ ë‹¤ë¥¸ ì˜ˆ)
motd file = /etc/rsyncd.motd
log file = /var/log/rsyncd.log
pid file = /var/run/rsyncd.pid
lock file = /var/run/rsync.lock
[simple_path_name]
   path = /rsync_files_here
   comment = My Very Own Rsync Server
   uid = nobody
   gid = nobody
   read only = no
   list = yes
   auth users = username
   secrets file = /etc/rsyncd.scrt
   host allow=192.168.0.4 /* ipì£¼ì†Œ : ì œí•œí•˜ì§€ ì•Šìœ¼ë©´ ëˆ„êµ¬ë‚˜ ë°ì´í„°ë¥¼ ê°€ì ¸ê°ˆ ìˆ˜ ìˆë‹¤. */

# mkdir /backup
# systemctl start rsyncd.service
# systemctl status rsyncd.service
â— rsyncd.service - fast remote file copy program daemon
   Loaded: loaded (/usr/lib/systemd/system/rsyncd.service; disabled; vendor preset: disabled)
   Active: active (running) since í™” 2020-03-31 17:08:24 KST; 1s ago
 Main PID: 1466 (rsync)
   CGroup: /system.slice/rsyncd.service
           â””â”€1466 /usr/bin/rsync --daemon --no-detach

 3ì›” 31 17:08:24 server2.example.com systemd[1]: Started fast remote file co...
 3ì›” 31 17:08:24 server2.example.com rsyncd[1466]: rsyncd version 3.1.2 star...
Hint: Some lines were ellipsized, use -l to show in full.

[SERVER1 ì—ì„œ ì‘ì—…]
# rsync -avz --delete -e ssh /backup 192.168.10.252:/backup
	> sshë¥¼ ì‚¬ìš©í•˜ì—¬ 22ë²ˆ portë¡œ ë™ì‘

[SERVER2]
# firewall-cmd --permanent --zone=public --add-service=rsyncd
# firewall-cmd --reload
[SERVER1] 
# rsync 192.168.10.252::
#

[SERVER2]
# vi /etc/rsyncd.conf
----------------------------
[backup]
        path = /backup
        comment = backup directory backup service
-----------------------------
[SERVER1] 
# rsync 192.168.10.252::
backup         	backup directory backup service
# rsync 192.168.10.252::backup
rsync: opendir "/." (in backup) failed: Permission denied (13)
drwxr-xr-x             20 2020/03/31 17:12:50 .
rsync error: some files/attrs were not transferred (see previous errors) (code 23) at main.c(1650) [generator=3.1.2]

# rsync 192.168.10.252::
backup         	backup directory backup service
# rsync -avz --delete -e ssh /backup 192.168.10.252::backup
sending incremental file list
rsync: link_stat "/backup/ssh" failed: No such file or directory (2)
rsync: read error: Connection reset by peer (104)
rsync error: error in socket IO (code 10) at io.c(785) [sender=3.1.2]

[SERVER2]
# vi /etc/rsyncd.conf
----------------------------
[backup]
				uid = root
				gid = root
        path = /backup
        comment = backup directory backup service
				**read only = no**
-----------------------------

[SERVER1] 
rsync -avz --delete -e ssh /backup 192.168.10.252::backup
```

SSHë¥¼ ì´ìš©í•œ íŒŒì¼ ë°±ì—… 

```bash
tar -cvf - [FILE|DIR|PATH] | ssh [IP|HOST] tar -xvf - -C [FILE|DIR|PATH]

# tar -cvf - /etc/  | ssh 192.168.10.200 'tar -xvf - -C /root'
```
