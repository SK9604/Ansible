# 기본 구성

![https://s3-us-west-2.amazonaws.com/secure.notion-static.com/7557ae48-556d-46f2-9c7b-47915e91d04e/Untitled.png](https://s3-us-west-2.amazonaws.com/secure.notion-static.com/7557ae48-556d-46f2-9c7b-47915e91d04e/Untitled.png)

## 기본 구성

```bash
Centos 8 설치
동일머신으로 클론 구성
Centos 8-1 Centos 8-2 Centos 8-3 Centos 8-4

LINUX VM구성 

언어 - 영어, 한글
키보드 - 영어, 한글
시간 - 서울
설치환경 - GUI -> runlevel 3 고정
네트워크 구성 - 자동
디스크 환경 - (100GB) auto 구성이지만 /home에 대한 구성을 5G로 축소하고 /에 모든 용량을 재 설정
```

설치가 종료된 이후 원본 VM을 Master-VM으로 이름을 변경힌다.

```bash

외부네트워크 확인 및 필수 패키지 설치
# vi /etc/hosts
----------------------
192.168.10.200  server1.example.com     server1
192.168.10.210  server2.example.com     server2
192.168.10.220  server3.example.com     server3
192.168.10.230  server4.example.com     server4
----------------------
# ping -c 1 www.google.com
# export LANG=C

server1 192.168.10.200
server2 192.168.10.210
server3 192.168.10.220
server4 192.168.10.230
subnet /24
dns 8.8.8.8
gateway 192.168.10.2

2. 추가 패키지 설정
# dnf list | grep epel
# dnf -y install epel-release
# dnf clean all
# dnf repolist
# dnf list

----패키지 설치---
# dnf -y install man-db-cron
# cd /etc/cron.daily
# ls
logrotate  man-db.cron
# ./man-db.cron
# dnf -y install bind-utils wget vim yum-utils sysstat setroubleshoot setroubleshoot-server setroubleshoot-plugins setools-console man man-pages kernel-doc net-tools tree screen bash-completion
# dnf -y install tlog
# dnf -y update
# reboot
# dnf config-manager --set-enabled powertools

# uname -a
Linux master.example.com 4.18.0-240.1.1.el8_3.x86_64 #1 SMP Thu Nov 19 17:20:08 UTC 2020 x86_64 x86_64 x86_64 GNU/Linux
# cat /etc/redhat-release
CentOS Linux release 8.3.2011
# systemctl set-default multi-user.target 
Removed /etc/systemd/system/default.target.
Created symlink /etc/systemd/system/default.target → /usr/lib/systemd/system/multi-user.target.
# systemctl get-default
multi-user.target
# init 6

clone master to SERVER1~4
# init 5
SERVER1
IP 192.168.10.200
subnet 255.255.255.0
G/W 192.168.10.2
DNS 8.8.8.8
hostname : server1.example.com < # hostnamectl set-hostname server1.example.com

SERVER2
IP 192.168.10.210
subnet 255.255.255.0
G/W 192.168.10.2
DNS 8.8.8.8
hostname : server2.example.com

SERVER3
IP 192.168.10.220
subnet 255.255.255.0
G/W 192.168.10.2
DNS 8.8.8.8
hostname : server3.example.com

SERVER4
IP 192.168.10.230
subnet 255.255.255.0
G/W 192.168.10.2
DNS 8.8.8.8
hostname : server4.example.com
# init 6
외부 터미널 접속 확인

3. 방화벽 해제
4. SELINUX 해제
5. 업데이트 
------------------

통신 테스트 및 확인절차
# hostname
# ping www.google.com
# nmcli dev show

# dnf list | grep net-tools
# dnf -y install net-tools
# ifconfig
# dnf -y install tree
# tree

# export LANG=C
# dnf list | grep epel 
epel-release.noarch                         7-11                       extras
# dnf -y install epel-release.noarch
# dnf list
# dnf list | grep bash
# dnf -y install bash-completion
# dnf -y install bash-completion-*
# dnf -y install iptraf-ng
# dnf -y install nmon
# systemctl reboot

--------------------------------------------------

# dnf -y install bind-utils wget elinks vim yum-utils sysstat system-config-firewall-tui policycoreutils-python setroubleshoot setroubleshoot-server setroubleshoot-doc setroubleshoot-plugins setools-console man man-pages kernel-doc

# timedatectl list-timezones | grep -i seoul
Asia/Seoul
# systemctl reboot
정상 구동 확인
# systemctl poweroff
* DVD 확인뒤 해제

Master-VM으로 SERVER1 SERVER2 SERVER3 SERVER4를 생성한다.

SERVER1 기준
각각의 서버에 다음과 같이 설정한다.
hostname                 IP
server1.example.com 192.168.10.200/24
server2.example.com 192.168.10.210/24
server3.example.com 192.168.10.220/24
server4.example.com 192.168.10.230/24

# hostnamectl set-hostname server1.example.com
# hostnamectl
   Static hostname: server1.example.com
# cat /etc/resolv.conf 
# Generated by NetworkManager
search example.com
nameserver 8.8.8.8

# nmcli con mod ens33 ipv4.addresses 192.168.10.200/24 ipv4.gateway 192.168.10.2 ipv4.dns 8.8.8.8 autoconnect yes ipv4.method manual
# reboot
--------SSH 접속했다는 가정--------
# nmcli con show ens33 | grep autoconnect
connection.autoconnect:                 예
#  nmcli con show ens33 | grep ipv4
ipv4.dns:                               8.8.8.8
ipv4.addresses:                         192.168.10.200/24
ipv4.gateway:                           192.168.10.2
#  nmcli con show ens33 | grep IP4
IP4.ADDRESS[1]:                         192.168.10.200/24
IP4.GATEWAY:                            192.168.10.2
IP4.ROUTE[1]:                           dst = 192.168.10.0/24, nh = 0.0.0.0, mt = 100
IP4.ROUTE[2]:                           dst = 0.0.0.0/0, nh = 192.168.10.2, mt = 100
IP4.DNS[1]:                             8.8.8.8
# vi .bashrc
export PS1='[SERVER1]# '

```

모든 사항을 확인한뒤 서버를 종료하고 스냅샷을 생성한다.

- 참고 Centos7 구성

> virtual network type

NAT

HOST-ONLY

bridged

VMware의 네트워크는 위에서 보듯이 크게 세가지로 나뉘어져 있다. 각각 사용되는 용도가 다르기 때문에 이해를 잘 해두어야 하고 목적에 맞는 것으로 교체하여 사용해 주길 바란다.

![https://s3-us-west-2.amazonaws.com/secure.notion-static.com/1ed18be4-e9dd-485c-b456-cb85da03b815/_2020-07-29__2.51.16.png](https://s3-us-west-2.amazonaws.com/secure.notion-static.com/1ed18be4-e9dd-485c-b456-cb85da03b815/_2020-07-29__2.51.16.png)

용어 정의

호스트 : 실제 물리적인 PC

게스트 : VM

![https://s3-us-west-2.amazonaws.com/secure.notion-static.com/b7a8647c-2bbb-4236-8ed4-837d280ccd9c/Untitled.png](https://s3-us-west-2.amazonaws.com/secure.notion-static.com/b7a8647c-2bbb-4236-8ed4-837d280ccd9c/Untitled.png)

### NAT

VMware를 실행하게 되면 서비스로 NAT서비스가 기동이 된다. 

이 서비스를 기반으로 하며 VMware에서는 게스트 컴퓨터가 외부로 나갈수 있게끔 네트워크를 지원하고 있으며 NAT를 통하여 통신을 하는 경우에 호스트와 게스트간의 통신 또한 지원 하고 있다.

NAT는 하나의 테이블이지만 쉽게 생각해서 NAT 연결을 위한 스위치가 하나 있다고 생각하자.

### HOST-ONLY

VM과 VM끼리의 통신을 위한 통로

게스트 PC들을 위한 라인 

여러개를 생성할 수 있으며 보통 하트비트용, 데이터 이동용으로 많이 사용된다.

### bridged

게스트PC의 경우에는 보통 NAT를 거쳐 통신을 하기 때문에 외부접속시 통신이 불가능 하다. 이것을 해결하기 위해 가정집 및 기업에 있는 라우터, 공유기에서 사용하고 있는 내부망 또는 공인 망에 네트워크 라인을 연결해 주는 방식이다.

기업에서 라우터를 사용하는 경우 :

공인 IP를 할당받아 해당 IP를 게스트 VM에 설정

bridged 방식으로 가상 NIC 카드의 속성을 변경

가정에서 공유기를 사용하는 경우:

DDNS 설정

포트 포워딩
