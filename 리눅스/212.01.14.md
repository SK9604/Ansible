[참고] 리눅스에서 호스트이름(Hostname) 변경하는 경우

```bash
# system-config-network-tui
or
# vi /etc/sysconfig/network 파일 수정

# vi /etc/hosts     <----- 일부 프로그램들이 호스트이름을 확인(예: oracle, apache, ....)
# service network restart

[참고] "service httpd restart" 에러메세지
# service httpd restart
Stopping httpd:                                            [FAILED]
Starting httpd: httpd: apr_sockaddr_info_get() failed for linux249.example.com
httpd: Could not reliably determine the server's fully qualified domain name, using 127.0.0.1 for 
    ServerName
# vi /etc/hosts 
.......
192.168.10.200 server1.example.com server1
# service httpd restat
```

```bash
# pgrep -lf httpd     (# ps -ef | grep httpd)
55866 httpd
55869 httpd
55870 httpd
55871 httpd
55872 httpd
55873 httpd
```

■ 윈도우 창에서 확인(IP 확인)

(Linux) **# firefox http://172.16.9.2XX**

■ 윈도우 창에서 확인(도메인 이름으로 확인)

(Linux) **# firefox http://www.linux2XX.example.com**

```bash
# cd /var/www/html 
# vi index.html
<HTML>
<BODY>
<CENTER><H1>linux2XX</H1></CENTER>
</BODY>
</HTML>
```

■ 윈도우 창에서 확인 (**http://www.linux2XX.example.com**)

-> **http://www.linux2XX.example.com**

-> 파트너시스템들에 대해서 **http://www.linux249.example.com** 요청을 해 본다.

(Linux) **# firefox http://www.linux2XX.example.com**

(Linux) **# firefox http://www.linux249.example.com**

[추가적인 실습] 도메인 등록 실습

```bash
① 도메인 등록
centos58.linux2XX.example.com 192.168.10.158 
centos59.linux2XX.example.com 192.168.10.159
server1.linux2XX.example.com 192.168.10.200 
② 도메인 등록 확인
# systemctl restart named-chroot || # systemctl reload named-chroot
# nslookup centos58 
# nslookup centos59 
# nslookup server1 
# firefox http://server1.linux2XX.example.com
```

[EX3] DNS 부하 분산

```bash
DNS 부하 분산
부하 분산 - load balancing
장비, 프로그램 한쪽으로만 요청에 들어오게 된다면 리소스 점유가 심각해지고 결국 장애로 이어진다.
물리적인 장비. 프로그램. VM.. 등등 여러가지 방법을 동원하여 나누어준다.
DNS 부하 분산
zone 파일에 여러 서버를 등록해두고 접속시에 라운드로빈 방식으로 처리하는 방법
```

```bash
(L4 부하분산)

+---DNS        +------ Web1 ------+
|              |                  |
----> L4 ------+------ Web2 ------+------ NAS/NFS
               |                  |
               +------ Web3 ------+
들어가는 시점에 각 세션이 몇개인지, 부하가 몇이나 걸렸는지 확인을 하고 가장 낮은 쪽으로 접속한다.
공유 스토리지 설정
	가상머신, 부하분산 웹서버. 뒷단에 꼭 공유 스토리지가 설정되어 있는 경우가 많다.
	각 웹서버에는 동일한 패키지가 있다. 때문에 nfs나 nas에서 파일을 물려준다.

(DNS 부하분산)

+---DNS        +------ Web1 ------+
|              |                  |
---> S/W ------+------ Web2 ------+------ NAS/NFS
               |                  |
               +------ Web3 ------+
계속 전환 시키면서 부하를 나눠 가지는 방식이다.
장점 : 구성이 간단하다.
단점 : 세션이 오래 유지되는 서버라 하더라도 기존의 연결은 무시하고 요구받는 IP로 접속이 되어 버린다. (이미 90% 사용하고있는 서버라 하더라도 순서가 오면 그쪽으로 연결된다)
```

다음은 "Windows Vista"의 "cmd" 창에서 실행한것이다.
**<CTRL + ESC>** => **cmd** => **<ENTER>
c:\> nslookup www.daum.net**

```bash
서버:    qns1.hananet.net
Address:  210.220.163.82

권한 없는 응답:
이름:    top.g.daum.net
Addresses:211.115.77.213
          211.115.77.214
          211.32.117.30
          211.115.77.211
          211.115.77.212
Aliases:  www.daum.net
```

c:\> nslookup [www.daum.net](http://www.daum.net/)

```bash
서버:    qns1.hananet.net
Address:  210.220.163.82

권한 없는 응답:
이름:    top.g.daum.net
Addresses:211.115.115.212
          222.231.51.40
          222.231.51.77
          222.231.51.78
          211.115.115.211
Aliases:  www.daum.net
```

c:\> nslookup [www.daum.net](http://www.daum.net/)

```bash
서버:    qns1.hananet.net
Address:  210.220.163.82

권한 없는 응답:
이름:    top.g.daum.net
Addresses:211.115.77.214
          211.32.117.30
          211.115.77.211
          211.115.77.212
          211.115.77.213
Aliases:  www.daum.net

-> 1~2초 정도에 한번씩 nslookup 명령어를 통해 정보를 요청해 보면, 첫번째 오는 아이피 주소가 변경된다는 것을 
   알수 있다. 출력된 내용의 첫번째 아이피쪽으로 도메인에 대한 IP 요청을 하게 된다.
```

**(시나리오)** 다음과 같이 도메인 등록을 해 달라고 요청이 들어왔다. 하나의 도메인 이름에 대해서 3개의 아이피가 연결 된다고 한다.

▪ 도메인이름(www.example.com) -> (192.168.10.200, 192.168.10.201, 192.168.10.202)

```bash
① Forward Zone 파일에 등록
# cd /var/named
# ls server*
server.rev  server.zone
# vi server.zone
$TTL 4
@       IN SOA  ns1.example.com. root.example.com. (
                                        0       ; serial
                                        1D      ; refresh
                                        1H      ; retry
                                        1W      ; expire
                                        3H )    ; minimum
        NS      @
        A       127.0.0.1
        AAAA    ::1
        IN      NS      ns1
ns1     IN      A       192.168.10.200
www     IN      A       192.168.10.200
www     IN      A       192.168.10.201               <--- 추가
www     IN      A       192.168.10.202               <--- 추가
ftp     IN      A       192.168.10.200
example.com.    IN      MX      10      mail.example.com.
mail    IN      A       192.168.10.200
cafe    IN      A       192.168.10.200

# service named restart 
-> Zone 파일 수정 내용 적용
```

```bash
② DNS 부하 분산 테스트
# nslookup www.example.com
Server:		192.168.10.200
Address:	192.168.10.200#53

Name:	www.example.com
Address: 192.168.10.200
Name:	www.example.com
Address: 192.168.10.202
Name:	www.example.com
Address: 192.168.10.201
```

```bash
# nslookup www.example.com
Server:		192.168.10.200
Address:	192.168.10.200#53

Name:	www.example.com
Address: 192.168.10.201
Name:	www.example.com
Address: 192.168.10.202
Name:	www.example.com
Address: 192.168.10.200
```

```bash
# nslookup www.example.com
Server:		192.168.10.200
Address:	192.168.10.200#53

Name:	www.example.com
Address: 192.168.10.202
Name:	www.example.com
Address: 192.168.10.201
Name:	www.example.com
Address: 192.168.10.200
```

[EX4] 도메인 위임(Domain Delegation)

도메인 위임은 일반적으로 웹호스팅 업체(예:가비아)에서 일반적으로 많이 사용하고 있다.

[참고] **domain(yahoo.com) 할당 받는 방법**(예: 가비아)

```bash
+---------------------- example.com ------------------------+
|* DNS(ns1.example.com)    < main domain                    |
|                                                           |
|   +----- linuxXXX.example.com --------+                   |
|   | * DNS(ns1.linuxXXX.example.com)   | < vpc             |
|   |                                   |                   |
|   |                                   |                   |
|   +-----------------------------------+                   |
|                                                           |
+-----------------------------------------------------------+
```

```bash
실습 X
■ DNS(ns.example.com)
# vi /var/named/chroot/var/named/exampleXXX.zone
..... (중략) .....
example.com.                  IN  NS  ns1.example.com.
ns1.example.com.              IN  A   192.168.10.200

linuxXXX                      IN  NS  ns1.linuxXXX.example.com.
ns1.linuxXXX.example.com.     IN  A   192.168.10.201

linuxXXX                      IN  NS  ns1.linuxXXX
ns1.linuxXXX                  IN  A   192.168.10.201
..... (중략) .....

or

..... (중략) .....
linuxXXX            IN  NS  ns1.linuxXXX
ns1.                IN  A   192.168.10.200
..... (중략) .....

아래 방법 더 추천
```

```bash
실습 X
# vi /var/named/example.rev
..... (중략) .....
2XX                           IN  PTR  ns1.linuxXXX.example.com.
-> 반드시 등록할 필요는 없다.
```

[EX] Hint Domain Administration

```bash
Hint 파일이 하는 일 : 현재 DNS에서 없는 내용을 상위, 또는 주변 DNS 정보를 참고하여 질의를 할 때 참조하는 파일
+----------------- . (Nameless Root Domain)-----------------+
|■ DNS(A.ROOT-SERVERS.NET)                                  |
|                                                           |
|   +------------ com ------------------+                   |
|   |■ DNS(ns.com)                      |                   |
|   |                                   |                   |
|   |                                   |                   |
|   +-----------------------------------+                   |
|                                                           |
+-----------------------------------------------------------+
```

```bash
메인 zone 파일
각각 계정에 맞추어 하나씩 다 생성하기

hint 파일을 가지고 제어
.com -> 전체 도메인 정보
172.16.8.200 ->
1.com 2.com...
```

■ DNS([A.ROOT-SERVER.NET](http://a.root-server.net/))

```bash
# vi /var/named/example254.zone
....
com.                          IN  NS  ns.com.
ns.com.                       IN  A   172.16.8.200
net.                          IN  NS  ns.net.
ns.net.                       IN  A   172.16.9.200
org.                          IN  NS  ns.org.
ns.org.                       IN  A   172.16.10.200
```

[EX5] Master DNS Server / Slave DNS Server 구축

```bash
마스터 -- 슬레이브
하나가 내려갔을 경우 나머지 하나를 서비스 용으로 사용하기 위함
```

```bash
----- Master DNS Server ---------- Slave DNS Server -----
      (172.16.9.2XX)               (172.16.9.1XX)

---------------------------------------------------------
						[그림] 실습 구조(Master/Slave DNS Server)
```

(전제조건) Master DNS Server - Slave DNS Server를 구축한다.

```bash
[server2] 
# dnf -y install bind bind-chroot bind-libs bind-utils
설치후 디렉토리 확인

# ls -l /var/named/
합계 16
drwxr-x---. 7 root  named   61  4월  7 23:59 chroot
drwxrwx---. 2 named named    6  8월  8  2019 data
drwxrwx---. 2 named named    6  8월  8  2019 dynamic
-rw-r-----. 1 root  named 2253  4월  5  2018 named.ca
-rw-r-----. 1 root  named  152 12월 15  2009 named.empty
-rw-r-----. 1 root  named  152  6월 21  2007 named.localhost
-rw-r-----. 1 root  named  168 12월 15  2009 named.loopback
drwxrwx---. 2 named named    6  8월  8  2019 slaves

# ls /etc/named*
/etc/named-chroot.files  /etc/named.rfc1912.zones
/etc/named.conf          /etc/named.root.key
/etc/named.iscdlv.key

▪ Master DNS Server : 192.168.10.200 (ns1.example.com) 
▪ Slave  DNS Server : 192.168.10.210 (ns2.example.com) 

▪ 한개의 도메인(example.com)에 두개의 DNS 서버(ns1/ns2.example.com)가 존재한다. 
▪ 두개의 DNS 서버는 각각 다른 IP(192.168.10.200/192.168.10.210)를 가지고 있다.
▪ (윈도우) cmd.exe
<CTRL + ESC> => "cmd"
C:\> nslookup –q=NS seoul.ac.kr 
C:\> nslookup –q=NS kornet.net 
C:\> nslookup –q=NS naver.com 
C:\> nslookup –q=NS daum.net
```

[Master DNS Server] 192.168.10.200

```bash
[server1]
-> Master DNS 서버의 전원 ON
① 주설정 파일 정보 확인 및 설정
Master DNS 서버에서 주 설정 파일은 특별히 설정할 필요가 없다.

# vi /etc/named.conf            
..... (중략) .....
options {
        listen-on port 53 { any; };
        listen-on-v6 port 53 { none; };
        directory       "/var/named";
        dump-file       "/var/named/data/cache_dump.db";
        statistics-file "/var/named/data/named_stats.txt";
        memstatistics-file "/var/named/data/named_mem_stats.txt";
        recursing-file  "/var/named/data/named.recursing";
        secroots-file   "/var/named/data/named.secroots";
        allow-query     { any; };
        allow-transfer  { 192.168.10.210; };  <----- 라인 변경 -> 삭제

# named-checkconf /etc/named.conf

# vi /etc/named.rfc1912.zones

..... (중략) .....
zone "0.in-addr.arpa" IN {
        type master;
        file "named.zero";
        allow-update { none; };
};

zone "example.com" IN {
        type master;
        file "server.zone";
        **also-notify { 192.168.10.210; };**   <----- 라인 추가
};

zone "10.168.192.in-addr.arpa"  IN {
         type master;
         file "server.rev";
         **also-notify { 192.168.10.210; };**  <----- 라인 추가
};

# named-checkconf /etc/named.rfc1912.zones
[참고]
"also-notify { 192.168.10.252; };" 자신의 Slave DNS 서버에게 변경 사항을 알려주는 설정
(주의) 이 설정이 없으면, 실시간적으로 Slave DNS 서버에 업데이트가 가능하지 않다.
```

```bash
② Forward-Zone/Reverse-Zone 파일 설정
# cd /var/named/chroot/var/named 
# ls
chroot   named.ca      named.localhost  server.zone
data     named.ca.old  named.loopback   slaves
dynamic  named.empty   server.rev
-> server.zone, server.rev 파일을 변경할 것이다.

# vi server.zone
$TTL    4
@               IN SOA  ns1.example.com. root.example.com. (
                                        42              ; serial (d. adams)
                                        3H              ; refresh
                                        15M             ; retry
                                        1W              ; expiry
                                        1D )            ; minimum
                IN NS           ns1
                **IN NS           ns2**              <----- 새로운 라인 추가
ns1             IN A            192.168.10.200
**ns2             IN A            192.168.10.210**     <----- 새로운 라인 추가
www	    IN	    A	      192.168.10.200
www     IN      A       192.168.10.201
www     IN      A       192.168.10.202
ftp     IN      A       192.168.10.200
example.com.    IN      MX 10   mail.example.com.
mail    IN      A       192.168.10.200
cafe    IN      A       192.168.10.200
nfs     IN      A       192.168.10.200
iscsi   IN      A       192.168.10.200
```

```bash
# vi server.rev
$TTL 4
@       IN SOA  ns1.example.com. root.example.com. (
                                        0       ; serial
                                        1D      ; refresh
                                        1H      ; retry
                                        1W      ; expire
                                        3H )    ; minimum
        NS      @
        A       127.0.0.1
        AAAA    ::1
				IN      NS      ns1.example.com.
        **IN      NS      ns2.example.com.**      <----- 새로운 라인 추가
200     IN      PTR     ns1.example.com.
**210     IN      PTR     ns2.example.com.**      <----- 새로운 라인 추가
```

```bash
③ 존 파일 수정 적용
/var/log/messages 파일을 모니터링 하면서 named를 restart 한다.
[SERVER1]
[TERM1] # tail -f /var/log/messages 
[TERM2] # service named restart 

# nslookup -q=NS example.com
Server:		192.168.10.200
Address:	192.168.10.200#53

example.com	nameserver = ns1.example.com.
example.com	nameserver = ns2.example.com.
example.com	nameserver = example.com.
```

[Slave DNS Server]

```bash
[server2]
-> Slave DNS 서버의 전원 ON

① 네트워크 설정
# ifconfig
ens33: flags=4163<UP,BROADCAST,RUNNING,MULTICAST>  mtu 1500
        inet 192.168.10.210  netmask 255.255.255.0  broadcast 192.168.10.255
        inet6 fe80::ffaf:3bf1:4ed1:2fc0  prefixlen 64  scopeid 0x20<link>
        inet6 fe80::92e3:7aab:f4fa:5d6e  prefixlen 64  scopeid 0x20<link>
        ether 00:0c:29:e2:26:15  txqueuelen 1000  (Ethernet)
        RX packets 8856  bytes 12037586 (11.4 MiB)
        RX errors 0  dropped 0  overruns 0  frame 0
        TX packets 2252  bytes 188589 (184.1 KiB)
        TX errors 0  dropped 0 overruns 0  carrier 0  collisions 0
```

```bash
-> 네트워크 설정을 한다.

■ Static IP    : 192.168.10.252/24
■ DNS Server   : 192.168.10.200 
~~■ DNS Server   : 168.126.63.1~~ 
# vi /etc/resolv.conf
# Generated by NetworkManager
search example.com
#nameserver 8.8.8.8
nameserver 192.168.10.200

■ Hostname       : server2.example.com
■ Primary DNS    : 192.168.10.200
~~# nmcli con mod ens33 ipv4.dns 192.168.10.200
# nmcli con mod ens33 +ipv4.dns 168.126.63.1~~
```

```bash
~~# nmcli con down ens33 ; nmcli con up ens33
-> 설정 내용 적용
# nmcli con show ens33 | grep -i ipv4.dns
ipv4.dns:                               192.168.10.200,168.126.63.1~~

② 주 설정 파일 확인 및 설정
# vi /etc/named.conf
options {
        listen-on port 53 { **any**; };
        listen-on-v6 port 53 { **none** ; };

        directory       "/var/named";
        dump-file       "/var/named/data/cache_dump.db";
        statistics-file "/var/named/data/named_stats.txt";
        memstatistics-file "/var/named/data/named_mem_stats.txt";
        recursing-file  "/var/named/data/named.recursing";
        secroots-file   "/var/named/data/named.secroots";
        allow-query     { **any**; };

# named-checkconf /etc/named.conf
```

```bash
# vi /etc/named.rfc1912.zones
..... (중략) .....
};

zone "0.in-addr.arpa" IN {
        type master;
        file "named.zero";
        allow-update { none; };
};

zone "example.com" IN {
        type slave;                    <----- 정보변경(master -> slave)
        masters { 192.168.10.200; };    <----- 새로운 라인 추가(172.16.9.2XX : Master DNS Server)
        file "slaves/server.zone"; <----- 정보변경
};

zone "10.168.192.in-addr.arpa" IN {
        type slave;                    <----- 정보변경(master -> slave)
        masters { 192.168.10.200; };    <----- 새로운 라인 추가(172.16.9.2XX : Master DNS Server)
        file "slaves/server.rev";  <----- 정보변경
};

# named-checkconf /etc/named.rfc1912.zones

# rpm -ql bind-chroot | grep sh
/usr/libexec/setup-named-chroot.sh
/var/named/chroot/usr/share/GeoIP
# /usr/libexec/setup-named-chroot.sh /var/named/chroot on
# mount | grep  chroot | tail -1
/dev/mapper/cl-root on /var/named/chroot/var/named type xfs (rw,relatime,seclabel,attr2,inode64,logbufs=8,logbsize=32k,noquota)
# systemctl start named-chroot
# systemctl status named-chroot
● named-chroot.service - Berkeley Internet Name Domain (DNS)
   Loaded: loaded (/usr/lib/systemd/system/named-chroot.service; disabled; vendor preset: disabled)
   Active: active (running) since 수 2020-04-08 00:14:14 KST; 4s ago
  Process: 1991 ExecStart=/usr/sbin/named -u named -c ${NAMEDCONF} -t /var/named/chroot $OPTIONS (code=exited, status=0/SUCCESS)
  Process: 1988 ExecStartPre=/bin/bash -c if [ ! "$DISABLE_ZONE_CHECKING" == "yes" ]; then /usr/sbin/named-checkconf -t /var/named/chroot -z "$NAMEDCONF"; else echo "Checking of zone files is disabled"; fi (code=exited, status=0/SUCCESS)
 Main PID: 1993 (named)
   CGroup: /system.slice/named-chroot.service
           └─1993 /usr/sbin/named -u named -c /etc/named.conf -t /var/named/chroot

 4월 08 00:14:14 server2.example.com named[1993]: network unreachable resolving './DNSKEY/IN': 2001:7fe::53#53
 4월 08 00:14:14 server2.example.com named[1993]: network unreachable resolving './DNSKEY/IN': 2001:500:a8::e#53
 4월 08 00:14:14 server2.example.com named[1993]: managed-keys-zone: Key 20326 for zone . acceptance timer complete: key now trusted
 4월 08 00:14:14 server2.example.com named[1993]: zone example.com/IN: Transfer started.
 4월 08 00:14:14 server2.example.com named[1993]: transfer of 'example.com/IN' from 192.168.10.200#53: connected using 192.168.10.252#46181
 4월 08 00:14:14 server2.example.com named[1993]: zone example.com/IN: transferred serial 0
 4월 08 00:14:14 server2.example.com named[1993]: transfer of 'example.com/IN' from 192.168.10.200#53: Transfer status: success
 4월 08 00:14:14 server2.example.com named[1993]: transfer of 'example.com/IN' from 192.168.10.200#53: Transfer completed: 1 messages, 12 records, 296...ytes/sec)
 4월 08 00:14:14 server2.example.com named[1993]: zone example.com/IN: sending notifies (serial 0)
 4월 08 00:14:15 server2.example.com named[1993]: resolver priming query complete
Hint: Some lines were ellipsized, use -l to show in full.

# systemctl enable named-chroot.service 
Created symlink /etc/systemd/system/multi-user.target.wants/named-chroot.service → /usr/lib/systemd/system/named-chroot.service.
# cd /var/named/slaves
# ls
server.rev  server.zone

# service named restart 
-> 변경 내용 적용
```

```bash
③ 존 파일 확인
# cd /var/named/chroot/var/named/slaves 
# ls -l
합계 8
-rw-r--r--. 1 named named 486  4월  8 18:03 server.rev
-rw-r--r--. 1 named named 693  4월  8 18:03 server.zone
-> 2개의 파일이 만들어진것을 확인 할 수 있다.
```

```bash
# cat server.zone
examplecom??s1examplecomrootexamplecomQ?	:?*03
examplecomns1examplecomns2examplecom7
mailexamplecom,cafeexamplecom??
?+ftpexamplecom??
?-iscsiexamplecom??
?,mailexamplecom??
?+nfsexamplecom??
?+ns1examplecom??
?+ns2examplecom??
?+wwwexamplecom??
```

```bash
# firewall-cmd --permanent --add-service=dns
success
# firewall-cmd --reload 
success
```

[EX6] 존 업데이트 실습

```bash
(선수지식) /var/named/chroot/var/named/(example2XX.zone or example2XX.rev)
------------------------------------------------------------------------------
@               IN SOA  ns1.example.com. root.example.com. (
                                        42              ; serial (d. adams)
                                        3H              ; refresh
                                        15M             ; retry
                                        1W              ; expiry
                                        1D )            ; minimum
------------------------------------------------------------------------------
S0A(Start Of Authority)
- [Domain]  [TTL]  IN  SOA  <DNS Server> <E-mail> (NNNN  NNNN  NNNN NNNN NNNN)

▪ 42  (Serial Number) (권장: 2010031100)
▪ 3H  (Refresh Time)       (권장: 12H, 1D)
▪ 15M (Retry Time)         (권장: 15M ~ 1H)
▪ 1W  (Expire Date)        (권장: 1W)
▪ 1D  (TTL, Time To Live)  (권장: 1D)
```

[Master DNS Server] 192.168.10.200

```bash
① Forward Zone 파일에 새로운 내용 업데이트 
# vi /var/named/chroot/var/named/server.zone
```

```bash
$TTL 4
@       IN SOA  ns1.example.com. root.example.com. (
                                        42      ; serial
                                        1D      ; refresh
                                        1H      ; retry
                                        1W      ; expire
                                        3H )    ; minimum
        NS      @
        A       127.0.0.1
        AAAA    ::1
        IN      NS      ns1
        IN      NS      ns2
ns1     IN      A       192.168.10.200
ns2     IN      A       192.168.10.210
www     IN      A       192.168.10.200
www     IN      A       192.168.10.201
www     IN      A       192.168.10.202
ftp     IN      A       192.168.10.200
example.com.    IN      MX      10      mail.example.com.
mail    IN      A       192.168.10.200
cafe    IN      A       192.168.10.200
blog    IN      A       192.168.10.252   <----- 새로운 라인 추가
```

```bash
② 서비스 적용 및 확인
# systemctl restart named-chroot 
-> 서비스 적용

# nslookup blog.example.com
Server:		192.168.10.210
Address:	192.168.10.210#53

Name:	blog.example.com
Address: 192.168.10.252
```

[Slave DNS Server] 172.16.9.1XX

```bash
① Forward Zone 파일(Zone 데이터) 확인
# cd /var/named/chroot/var/named/slaves 
# grep test example2XX.zone 
#
-> 출력되는 내용이 없다. (현재 버전에서는 텍스트 파일이 아니기 때문에 해당 실습은 진행하지 않는다.)

# nslookup blog.example.com
Server:		192.168.10.210
Address:	192.168.10.210#53

Name:	blog.example.com
Address: 192.168.10.252
-> 시리얼 넘버를 업데이트 하였기에 동일하게 252으로 IP가 출력되는 것을 확인 할 수 있다.
```

**(주의)** Slave DNS 서버에 Zone 데이터가 업데이트가 되지 않은 이유

- Master DNS 서버 관리자가 Zone 데이터를 변경 할때는 반드시 serial number 값을 기존의 값보다 높여 줘야 한다.
- 그렇지 않으면, Slave DNS 서버쪽으로 Zone 데이터를 업데이트 되지 않는다. 그럼 한개의 도메인에 두대의 DNS 서버가 존재하지만 두대의 서버의 내용은 불일치 하게 된는 것이다.

```bash
② Slave DNS 서버 모니터링
Slave DNS 서버에서는 모니터링을 시작한다. 
[TERM1] # cd /var/named/chroot/var/named/slaves 
        # watch grep test example2XX.zone   (# watch CMD)
[TERM2] # tail -f /var/log/messages
```

[Master DNS Server] 172.16.9.2XX

```bash
① Forward Zone 파일 내용 추가
# vi /var/named/chroot/var/named/server.zone
$TTL 4
@	IN SOA	ns1.example.com. root.example.com. (
					43	; serial
					1D	; refresh
					1H	; retry
					1W	; expire
					3H )	; minimum
	NS	@
	A	127.0.0.1
	AAAA	::1
	IN	NS	ns1
	IN	NS	ns2
ns1	IN	A	192.168.10.200
ns2	IN	A	192.168.10.210
www	IN	A	192.168.10.200
www	IN	A	192.168.10.201
www	IN	A	192.168.10.202
ftp	IN	A	192.168.10.200
example.com.	IN	MX	10	mail.example.com.
mail	IN	A	192.168.10.200
cafe	IN	A	192.168.10.200
file	IN	CNAME	cafe.example.com.
blog	IN	A 	192.168.10.252
test	IN	A 	192.168.10.222      <----- 새로운 라인 추가

② 서비스 변경 적용
# systemctl restart named-chroot
-> 서비스 적용

# nslookup test.example.com
-> 확인

[Slave DNS Server] 192.168.10.210 
slave 서버를 DNS로 지정하고 확인한다.
[root@server4 ~]# nslookup test.example.com
Server:		192.168.10.210
Address:	192.168.10.210#53

Name:	test.example.com
Address: 192.168.10.222
 
-> 변경된 내용을 확인 할 수 있다.
-> Zone 파일(Forward/Reverse Zone 파일)을 지우고 "# service named restart" 해서 다시 Zone 파일을 받으면 업
   데이트가 되지만, 이런 경우는 실시간적인 동기화가 되지는 않는 상태이므로 좋은 방법은 아니다.
-> DNS Master 서버에서 시리얼 번호(Serial Number) 업데이트 없이 Zone 파일을 업데이트 하고 데몬을 restart 
   했다고 해서 Zone 파일이 업데이트 되지는 않는다.
```

- [EX7] rndc 실습
- [EX8] allow-update 설정
- [EX9] allow-tranfer 설정

```bash
메일서버 - > MX * 

Master - SERVER1
Slave - SERVER2

DNS 설정 및 구성 그리고 확인

클라이언트- /etc/resolv.conf
         nslookup - bind-utils

서버 - 
필요 패키지 bind bind-chroot bind-libs bind-utils

서버의 기본 설정 사항을 확인한다.
/etc/named*
/var/named

/etc/named.conf
-> DNS의 질의를 받는 대상이 자신뿐만이 아니라 나머지 클라이언트에게도 가능하도록 설정해줘야한다.
/etc/named.rfc1912.zones
-> ZONE에 대한 정의
    도메인 정보와 도메인에서 사용할 파일에 대한 정의
zone "example.com" IN {   이 존은 example.com 도메인에 대한 정방향 존파일이다.
	type master;            이 구역이 마스터 파일
	file "server.zone";     example.com 을 정의하는 파일은 /var/named/server.zone 파일이다.
	};
	
설정파일을 수정한뒤 문법 체크를 해본다.
# named-checkconf /etc/named.conf 
# named-checkconf /etc/named.rfc1912.zones 
 -* 완벽한건 아니다.

# cd /var/named
힌트 파일 재구성
기존의 힌트파일은 삭제, 이동
# vi hint.ca
.                       86400   IN      NS      ns1.example.com.   < 이 DNS로 질의되는 내용중에 내가 가지고 있지 않은 도메인에 대해서 확인하는 경우 질의 도에인을 ns1.example.com으로 설정하겠다.
ns1.example.com.        86400   IN      A       192.168.10.200     <

zone 파일 생성

# named-checkzone example.com server.zone 존 파일에 대하여 문법 확인
# named-checkzone 10.168.192.in-addr.arpa server.rev  역방향 존 파일에 대하여 확인

서비스를 실행하기 전에 확인
파일들의 그룹 소유자가 named로 되어 있는지 확인하고 그렇지 않은 경우에는 chown 명령어를 이용하여 변경한다.

chroot 구성으로 변경
# /usr/libexec/setup-named-chroot.sh /var/named/chroot on

# systemctl restart named-chroot
status
enable

방화벽 구성
firewall-cmd --permanant --add-service=dns
firewall-cmd --reload
```

# DNS

어떤 도메인을 사용할 것인가?

호스트는 어떠한 서브 도메인을 사용할 것인가?

마스터, 슬레이브 형태로 할 것인가?

구축 전에 DNS 구성 (설계)부터

구성에 대한 순서도

단계별로 어떤 파일에 어떤 내용을 넣을 것인가?
