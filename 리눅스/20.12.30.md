## 환경 파일이란?

환경 파일은 사용자가 로그인하거나 새로운 쉘을 실행할 때 자동으로 실행되는 명령을 저장한 파일이다. 시스템 환경 파일과 사용자 환경 파일이 있으며 쉘마다 다른 이름의 파일을 사용한다. 시스템 환경 파일은 전체 사용자의 공통 환경을 설정하는 파일이고, 사용자 환경 파일은 각 사용자의 홈 디렉터리에 숨김 파일로 생성되어 사용자가 내용을 수정하고 관리할 수 있다.

## 환경 파일의 종류와 역할

bash는 다섯 개의 설정 파일이 존재하며 각 파일의 역할은 이러하다.

/etc/profile : 환경 변수와 bash가 수행될 때 실행되는 프로그램을 제어하는 전역적인 시스템 설정과 관련된 파일이다.

```bash
# /etc/profile

# System wide environment and startup programs, for login setup
# Functions and aliases go in /etc/bashrc

# It's NOT a good idea to change this file unless you know what you
# are doing. It's much better to create a custom.sh shell script in
# /etc/profile.d/ to make custom changes to your environment, as this
# will prevent the need for merging in future updates.

...중략...
done

unset i
unset -f pathmunge

if [ -n "${BASH_VERSION-}" ] ; then
        if [ -f /etc/bashrc ] ; then
                # Bash login shells run only /etc/profile
                # Bash non-login shells run only /etc/bashrc
                # Check for double sourcing is done in /etc/bashrc.
                . /etc/bashrc
       fi
fi
```

/etc/bashrc : 별칭(alias)과 bash가 수행될 때 실행되는 함수를 제어하는 전역적인 시스템 설정과 관련된 파일이다. 때때로 생략되어 /etc/profile에 포함되기도 한다.

.bash_profile : 환경 변수와 bash가 수행될 때 실행되는 프로그램을 제어하는 지역적인 시스템 설정과 관련된 파일이다. 이들 환경 변수는 오직 그 사용자에게만 한정되며, 그 이외의 다른 사람에게는 영향을 미치지 않는다. 이 파일은 전역적인 설정 파일인 /etc/profile이 수행된 다음 바로 수행된다.

```bash
# .bash_profile

# Get the aliases and functions
if [ -f ~/.bashrc ]; then
	. ~/.bashrc
fi

# User specific environment and startup programs

PATH=$PATH:$HOME/bin

export PATH
```

.bashrc : 별칭(alias)과 bash가 수행될 때 실행되는 함수를 제어하는 지역적인 시스템 설정과 관련된 파일이다. 이들 별칭과 함수들은 오직 그 사용자에게만 한정되며, 그 이외의 다른 사람에게는 영향을 미치지 않는다. 이 파일은 전역적인 설정 파일인 /etc/bashrc이 수행된 다음 바로 수행된다.

```bash
# .bashrc

# User specific aliases and functions

alias rm='rm -i'
alias cp='cp -i'
alias mv='mv -i'
alias cdt='cd /test'
alias rmt='cd /test && rm -rf *'

# Source global definitions
if [ -f /etc/bashrc ]; then
	. /etc/bashrc
fi
```

.bash_logout : 사용자가 로그아웃하기 바로 직전에 실행하는 프로그램에 관한 bash의 지역적인 시스템 설정과 관련된 파일이다. 이들 프로그램은 오직 그 프로그램을 실행하는 사용자에게만 영향을 끼치지 다른 사람에게는 아무런 영향을 주지 않는다.

## 로컬 접속 시 환경 정책

1. umask 027로 조정

    일반 사용자들이 파일을 생성할 때 다른 사용자가 해당 파일이나 디렉터리를 마음대로 수정하거나 읽을 수 없도록 처음부터 일반 사용자에 대한 권한을 주지 않도록 한다. 계정의 Start Profile(/etc/profile)에 명령을 추가하면, 사용자가 새로운 쉘에서 로그인 한 후에도 변경된 umask 값을 적용받게 된다.

    ```bash
    # /etc/profile

    ...중략...
    xport PATH USER LOGNAME MAIL HOSTNAME HISTSIZE HISTCONTROL

    # By default, we want umask to get set. This sets it for login shell
    # Current threshold for system reserved uid/gids is 200
    # You could check uidgid reservation validity in
    # /usr/share/doc/setup-*/uidgid file
    if [ $UID -gt 199 ] && [ "`/usr/bin/id -gn`" = "`/usr/bin/id -un`" ]; then
        umask 002
    else
        umask 027 < 수정
    fi
    ...중략...
    fi
    ```

2. 일반 사용자 su 명령어 사용 제한

    su 명령어는 기본적으로 사용자 전환에 사용되며, su –로 접근 시 해당 계정의 권한까지 사용한다. 따라서 root 계정으로 접근할 수 있는 su 명령어를 일반 사용자들이 사용할 수 없도록 하는 설정이 필요하다.

    ```bash
    # ls -l /usr/bin/su
    -rwsr-xr-x. 1 root root 50320 Jul 22 01:55 /usr/bin/su
    # chmod 4750 /usr/bin/su ; ls -l /usr/bin/su
    -rwsr-x---. 1 root root 50320 Jul 22 01:55 /usr/bin/su
    ```

[umask 참조 문서](https://access.redhat.com/documentation/en-us/red_hat_enterprise_linux/8/html/configuring_basic_system_settings/file-permissions-rhel8_configuring-basic-system-settings)

[환경 파일 참조 문서](https://www.ibm.com/support/knowledgecenter/ssw_aix_72/filesreference/environment.html)
