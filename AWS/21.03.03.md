# RDS 실습

- 캡처

표준 → MySQL → MySQL 8.0.20 → 프리 티어 → DB 인스턴스 식별자 : mysql-prod → 마스터 사용자 이름 : myadmin → 마스터 암호 : password#123 → t2.micro → 범용(SSD) → 20~30 GiB → RDS는 VPC내에 서브넷에 생성된다 → VPC 보안 그룹 새로 생성 → 이름 : rds-sg → 가용 영역 : ap-northeast-2c → 추가 구성 → 초기 데이터베이스 이름 : awsdb → 자동 백업 비 활성화 → 마이너 버전 자동 업그레이드 사용 체크 해제 → 요금 확인 후 데이터베이스 생성 → 생성된 데이터베이스 클릭 → VPC 보안 그룹 클릭 → 인바운드 규칙 편집 → 소스에 EC2에서 사용중인 보안그룹 아이디를 붙여넣기 → 규칙 저장 → 사용 가능 상태 확인

### Amazon CloudWatch Logs로 게시

RDS에 장애가 발생한 경우 → 로그 분석을 통해 원인 파악

### EC2 PuTTY 접속

```
-- 설치
$ sudo yum -y install mysql

-- 버전 확인
$ mysql --version
	mysql  Ver 15.1 Distrib 5.5.68-MariaDB, for Linux (x86_64) using readline 5.1

-- 엔드포인트를 이용해 연결
$ mysql -u myadmin -p -h mysql-prod.cap4qohols82.ap-northeast-2.rds.amazonaws.com
Enter password: (password#123)
Welcome to the MariaDB monitor.  Commands end with ; or \g.
Your MySQL connection id is 14
Server version: 8.0.20 Source distribution

Copyright (c) 2000, 2018, Oracle, MariaDB Corporation Ab and others.

Type 'help;' or '\h' for help. Type '\c' to clear the current input statement.

MySQL [(none)]> show databases;
+--------------------+
| Database           |
+--------------------+
| awsdb              |
| information_schema |
| mysql              |
| performance_schema |
| sys                |
+--------------------+
5 rows in set (0.00 sec)

MySQL [(none)]> select version();
+-----------+
| version() |
+-----------+
| 8.0.20    |
+-----------+
1 row in set (0.00 sec)

MySQL [(none)]> use awsdb;
Database changed
MySQL [awsdb]> create table awstab1 (id int, product varchar(20));
Query OK, 0 rows affected (0.03 sec)

MySQL [awsdb]> insert into awstab1 values (100, 'mysql');
Query OK, 1 row affected (0.00 sec)

MySQL [awsdb]> select * from awstab1;
+------+---------+
| id   | product |
+------+---------+
|  100 | mysql   |
+------+---------+
1 row in set (0.00 sec)

MySQL [awsdb]> status
--------------
mysql  Ver 15.1 Distrib 5.5.68-MariaDB, for Linux (x86_64) using readline 5.1

Connection id:          14
Current database:       awsdb
Current user:           myadmin@172.31.42.156
SSL:                    Not in use
Current pager:          stdout
Using outfile:          ''
Using delimiter:        ;
Server:                 MySQL
Server version:         8.0.20 Source distribution
Protocol version:       10
Connection:             mysql-prod.cap4qohols82.ap-northeast-2.rds.amazonaws.com via TCP/IP
Server characterset:    utf8mb4
Db     characterset:    utf8mb4
Client characterset:    utf8
Conn.  characterset:    utf8
TCP port:               3306
Uptime:                 12 min 30 sec

Threads: 3  Questions: 9531  Slow queries: 0  Opens: 704  Flush tables: 4  Open tables: 176  Queries per second avg: 12.708
--------------
```

## MySQL Workbench

- 캡처

화면 중앙의 MySQL Connections 옆에 + 버튼 선택 → connection name 설정: AWS-RDS-mysql-prod → connection method : standard tcp/ip over ssh → ssh hostname: ec2 퍼블릭 ipv4주소 → ssh username : ec2-user → ssh key file : 사용하던 pem 키 → mysql hostname : rds 엔드포인트 주소 → username : myadmin → ok → password 입력 → 쿼리 입력 실행(드래그 후 번개모양)

### PuTTY

```
MySQL [(none)]> create database aws_empdb;
Query OK, 1 row affected (0.01 sec)

MySQL [(none)]> create user 'awsinsa'@'????' identified by 'aws4U';
Query OK, 0 rows affected (0.00 sec) -> ???:EC2의 private IPv4 주소

MySQL [(none)]> grant all privileges on aws_empdb.* to 'awsinsa'@'172.31.42.156';
Query OK, 0 rows affected (0.00 sec)

MySQL [(none)]> flush privileges;
Query OK, 0 rows affected (0.01 sec)

MySQL [(none)]> select user authentication_string, plugin, host from mysql.user;
+-----------------------+-----------------------+---------------+
| authentication_string | plugin                | host          |
+-----------------------+-----------------------+---------------+
| myadmin               | mysql_native_password | %             |
| awsinsa               | mysql_native_password | 172.31.42.156 |
| mysql.infoschema      | caching_sha2_password | localhost     |
| mysql.session         | caching_sha2_password | localhost     |
| mysql.sys             | caching_sha2_password | localhost     |
| rdsadmin              | mysql_native_password | localhost     |
+-----------------------+-----------------------+---------------+
6 rows in set (0.00 sec)

MySQL [(none)]> exit
Bye
$ git clone https://github.com/datacharmer/test_db.git
Cloning into 'test_db'...
remote: Enumerating objects: 11, done.
remote: Counting objects: 100% (11/11), done.
remote: Compressing objects: 100% (7/7), done.
remote: Total 116 (delta 5), reused 8 (delta 4), pack-reused 105
Receiving objects: 100% (116/116), 74.27 MiB | 19.05 MiB/s, done.
Resolving deltas: 100% (59/59), done.
$ cd test_db/
$ ls
Changelog                      load_dept_manager.dump  README.md
employees_partitioned_5.1.sql  load_employees.dump     sakila
employees_partitioned.sql      load_salaries1.dump     show_elapsed.sql
employees.sql                  load_salaries2.dump     sql_test.sh
images                         load_salaries3.dump     test_employees_md5.sql
load_departments.dump          load_titles.dump        test_employees_sha.sql
load_dept_emp.dump             objects.sql             test_versions.sh

$ mysql -u awsinsa -p -h mysql-prod.cap4qohols82.ap-northeast-2.rds.amazonaws.com aws_empdb
Enter password: (aws4U)

MySQL [aws_empdb]> status
--------------
mysql  Ver 15.1 Distrib 5.5.68-MariaDB, for Linux (x86_64) using readline 5.1

Connection id:          30
Current database:       aws_empdb
Current user:           awsinsa@172.31.42.156
SSL:                    Not in use
Current pager:          stdout
Using outfile:          ''
Using delimiter:        ;
Server:                 MySQL
Server version:         8.0.20 Source distribution
Protocol version:       10
Connection:             mysql-prod.cap4qohols82.ap-northeast-2.rds.amazonaws.com via TCP/IP
Server characterset:    utf8mb4
Db     characterset:    utf8mb4
Client characterset:    utf8
Conn.  characterset:    utf8
TCP port:               3306
Uptime:                 47 min 12 sec

Threads: 5  Questions: 10995  Slow queries: 0  Opens: 776  Flush tables: 4  Open tables: 248  Queries per second avg: 3.882
--------------

MySQL [aws_empdb]> source employees.sql

MySQL [aws_empdb]> show tables;
+----------------------+
| Tables_in_aws_empdb  |
+----------------------+
| current_dept_emp     |
| departments          |
| dept_emp             |
| dept_emp_latest_date |
| dept_manager         |
| employees            |
| salaries             |
| titles               |
+----------------------+
8 rows in set (0.01 sec)
```

### Workbench에 관계형 데이터 새로 연결

- 캡처

Connection Name : RDS-awsinsa → Connection Method : Standard TCP/IP over SSH → SSH hostname : EC2 public IPv4:22 → SSH Username : ec2-user → SSH key File : pem 키 → MySQL Hostname : RDS 엔드포인트 → username : awsinsa → password store in vault : aws4U → OK

홈 화면 → 왼쪽 2번째 메뉴 → Models 옆 > 문자 → create EER Model From Database → AWS-RDS-mysql-prod → next → next → select the schemas : aws_empdb → 계속 default로 next → 관계 확인 

# AWS 기반 네트워킹 1부

### 네트워크 계층

![https://s3-us-west-2.amazonaws.com/secure.notion-static.com/15f70cae-9296-421f-bce7-68c094f14fe5/Untitled.png](https://s3-us-west-2.amazonaws.com/secure.notion-static.com/15f70cae-9296-421f-bce7-68c094f14fe5/Untitled.png)

Route 53을 한 단어로 표현하면 "DNS" 이다.

## Amazon Virtual Private Cloud (VPC)

VPC 논리적으로 격리된 공간을 제공

IP 주소, subnet, route table, gateway... 를 제공해준다.

### VPC란 무엇입니까?

AWS Cloud의 프라이빗 네트워크 공간

워크로드에 대한 논리적 격리를 제공합니다.

리소스에 대한 사용자 지정 액세스 제어 및 보안 설정을 허용합니다.

### VPC 세부사항

VPC는 AWS 계정 전용 가상 네트워크입니다.

IPv4 또는 IPv6 주소 범위에 존재합니다.

점유 리소스에 대한 특정 CIDR 범위를 생성할 수 있습니다.(IPv4 CIDR 블록을 필수)

인바운드 및 아웃바운드 트래픽에 대한 엄격한 액세스 규칙을 제공합니다.

### VPC 배포

VPC는 21개의 AWS 리전 중 1개 리전에 배포됩니다.

VPC 리전 내 모든 가용 영역의 리소스를 호스팅할 수 있습니다.

### 하나의 VPC 사용

하나의 VPC가 적절한 사용 사례는 제한적입니다.

- 한 명 또는 매우 작은 팀이 관리하는 소규모 단일 애플리케이션
- 고성능 컴퓨팅
- 자격 증명 관리

대부분의 사용 사례에서는 인프라를 구성하는 데 2개의 기본 패턴을 사용합니다.

다중 VPC 및 복수 계정

### 다중 VPC 패턴

다음에 가장 적합:

- 단일 팀 또는 단일 조직(예: 관리형 서비스 공급자)
- 더 쉽게 표준 상태를 유지하고 액세스를 관리할 수 있는 제한된 팀

예외 :

- 거버넌스 및 규정 준수 표준은 조직의 복잡성과 관계없이 워크로드 격리를 요구할 수 있습니다.

### 복수 계정 패턴

다음에 가장 적합 :

- 대규모 조직 및 여러 IT 팀이 있는 조직
- 빠른 성장이 예상되는 중간 규모의 조직

그 이유는 무엇일까요?

- 액세스 및 표준 관리는 조직이 복잡할수록 더 어려울 수 있습니다.

### VPC 제한

동일한 리전 또는 다른 리전에 여러 VPC를 보유할 수 있습니다.

서비스 제한: 계정당 리전당 VPC 5개

### VPC 및 IP 주소 지정

- 각 VPC는 사용자가 지정하는 프라이빗 IP 주소의 범위를 예약합니다.
- 이러한 프라이빗 IP 주소는 해당 VPC에 배포된 리소스에서 사용할 수 있습니다.
- IP 범위는 CIDR(Classless Inter-Domain Routing) 표기법을 사용하여 정의됩니다.
- 고유 IP 주소 가져오기(BYOIP-Bring Your Own IP) 접두사 지원

    예) 10.0.0.0/16 = 10.0.0.0에서 10.0.255.255까지의 모든 IP

```
10.1.0.0/24
----------HostID---------- --NetID-
00001010.00000001.00000000.00000000
   8        8        8         8
10.1.0.255
	ㄴ ip : 10.1.0.0 ~ 10.1.0.255 (0, 255, aws예약(1,2)) -> 256개
	ㄴ AWS IP -> 251개
```

### CIDR 예

![https://s3-us-west-2.amazonaws.com/secure.notion-static.com/be2925e8-bfdd-4c92-a5fd-301a127f43a7/Untitled.png](https://s3-us-west-2.amazonaws.com/secure.notion-static.com/be2925e8-bfdd-4c92-a5fd-301a127f43a7/Untitled.png)

![https://s3-us-west-2.amazonaws.com/secure.notion-static.com/8f022af2-5613-420c-b304-f38e179c8560/Untitled.png](https://s3-us-west-2.amazonaws.com/secure.notion-static.com/8f022af2-5613-420c-b304-f38e179c8560/Untitled.png)

![https://s3-us-west-2.amazonaws.com/secure.notion-static.com/22367d50-33cc-4da5-bad7-a5400d46dcc1/Untitled.png](https://s3-us-west-2.amazonaws.com/secure.notion-static.com/22367d50-33cc-4da5-bad7-a5400d46dcc1/Untitled.png)

### 서브넷을 사용하여 VPC 분리

![https://s3-us-west-2.amazonaws.com/secure.notion-static.com/5ff0ba04-c87c-438b-98a6-9746f498877e/Untitled.png](https://s3-us-west-2.amazonaws.com/secure.notion-static.com/5ff0ba04-c87c-438b-98a6-9746f498877e/Untitled.png)

### 서브넷: 키 속성

- 서브넷은 VPC CIDR 블록의 하위 집합입니다.
- 서브넷 CIDR 블록은 중첩될 수 없습니다.
- 각 서브넷은 하나의 가용 영역 내에서만 존재합니다.
- 가용 영역에 서브넷이 여러 개 포함될 수 있습니다.

AWS는 각 서브넷에 5개의 IP 주소를 예약합니다.

![https://s3-us-west-2.amazonaws.com/secure.notion-static.com/8a1b8ae9-e531-45fe-a76b-a6d957bc3ae4/Untitled.png](https://s3-us-west-2.amazonaws.com/secure.notion-static.com/8a1b8ae9-e531-45fe-a76b-a6d957bc3ae4/Untitled.png)

### 라우팅 테이블: VPC 리소스 간에 트래픽 보내기

라우팅 테이블: VPC내에서 VPC 외부로 연결할 경우 생성

- VPC 리소스 간에 트래픽을 연결하는 데 필요합니다.
- 각 VPC에는 주요(기본) 라우팅 테이블이 있습니다.
- 사용자 지정 라우팅 테이블을 생성할 수 있습니다.
- 모든 서브넷에는 연결된 라우팅 테이블이 있어야 합니다.

모범 사례: 각 서브넷에 대해 사용자 지정 라우팅 테이블 사용

### 서브넷을 통해 허용되는 다양한 수준의 네트워크 격리

![https://s3-us-west-2.amazonaws.com/secure.notion-static.com/ba172991-ea00-4879-b2b7-7fe04a7b59c0/Untitled.png](https://s3-us-west-2.amazonaws.com/secure.notion-static.com/ba172991-ea00-4879-b2b7-7fe04a7b59c0/Untitled.png)

서브넷을 사용하여 인터넷 액세스 접근성을 정의합니다.

퍼블릭 서브넷

- 퍼블릭 인터넷에 대한 인바운드/아웃바운드 액세스를 지원하도록 인터넷 게이트웨이에 대한 라우팅 테이블 항목을 포함합니다.

프라이빗 서브넷

- 인터넷 게이트웨이에 대한 라우팅 테이블 항목이 없습니다.
- 퍼블릭 인터넷에서 직접 액세스 할 수 없습니다.
- 일반적으로 제한된 아웃 바운드 퍼블릭 인터넷 액세스를 지원하기 위해 NAT 게이트웨이를 사용합니다.

### 퍼블릭 서브넷에 인터넷 연결

**인터넷 게이트웨이**(리소스와 공용 인터넷 간의 완전 관리형)

- VPC의 인스턴스와 인터넷 간에 통신을 허용합니다.
- 기본적으로 가용성이 뛰어나고, 중복적이며, 수평적으로 확장됩니다.(별도의 라우터 구성 불필요)
- 인터넷으로 라우팅 가능한 트래픽에 대한 서브넷 라우팅 테이블에 대상을 제공합니다.

![https://s3-us-west-2.amazonaws.com/secure.notion-static.com/0d52fbc0-02a8-4ecc-a582-8c19ce9c99bc/Untitled.png](https://s3-us-west-2.amazonaws.com/secure.notion-static.com/0d52fbc0-02a8-4ecc-a582-8c19ce9c99bc/Untitled.png)

```
--AWS Object(service) = network 구조체
VPC, subnet, route table, IGW, NAT gateway...
```

**NAT 게이트 웨이**

- 프라이빗 서브넷의 인스턴스가 인터넷 또는 다른 AWS 서비스로의 아웃바운드 트래픽을 사용하도록 활성화합니다.
- 프라이빗 인스턴스가 인터넷에서 인바운드 트래픽을 수신하는 것을 차단합니다.

![https://s3-us-west-2.amazonaws.com/secure.notion-static.com/207d6833-35b8-445f-9bb1-fdcb39a3149c/Untitled.png](https://s3-us-west-2.amazonaws.com/secure.notion-static.com/207d6833-35b8-445f-9bb1-fdcb39a3149c/Untitled.png)

### 서브넷 사용 사례

데이터 스토어 인스턴스 → 프라이빗 서브넷

배치 처리 인스턴스 → 프라이빗 서브넷

백엔드 인스턴스 → 프라이빗 서브넷

웹 애플리케이션 인스턴스 → 퍼블릭 또는 프라이빗 서브넷

### 서브넷 권장 사항

작은 크기보다는 더 큰 크기의 서브넷을 고려합니다(/24이상).

워크로드 배치 간소화:

- 워크로드를 10개의 작은 서브넷 중 어디에 배치할지 선택하는 것이 1개의 큰 서브넷보다 더 복잡합니다.

IP를 낭비하거나 IP가 부족할 확률이 낮음:

- 서브넷에서 사용 가능한 IP가 부족한 경우, 해당 서브넷에 IP를 추가할 수 없습니다.

### 기본 서브넷 구성

서브넷을 설정하기 위한 가장 좋은 방법을 잘 모르는 경우:

가용 영역당 1개의 퍼블릭 서브넷과 1개의 프라이빗 서브넷으로 시작합니다.

대부분의 아키텍처에는 퍼블릭 리소스보다 프라이빗 리소스가 훨씬 많습니다.

퍼블릭 서브넷보다 프라이빗 서브넷에 훨씬 더 많은 IP를 할당합니다.

![https://s3-us-west-2.amazonaws.com/secure.notion-static.com/418f9358-76b3-48a1-9044-ddd2de5e89c9/Untitled.png](https://s3-us-west-2.amazonaws.com/secure.notion-static.com/418f9358-76b3-48a1-9044-ddd2de5e89c9/Untitled.png)

### 탄력적 네트워크 인터페이스

탄력적 네트워크 인터페이스는 가상 네트워크 인터페이스입니다.

동일한 가용영역 안에서 EC2 인스턴스간에 이동할 수 있습니다.

새 인스턴스로 이동하면 네트워크 인터페이스는 다음을 유지합니다.

- 프라이빗  IP 주소
- 탄력적 IP 주소
- MAC 주소

인스턴스에 네트워크 인터페이스가 두 개 이상 있는 이유는 무엇입니까?

요구사항:

- 관리 네트워크 생성
- VPC에서 네트웤크 및 보안 어플라이언스 사용
- 별도의 서브넷에 있는 워크로드/역할로 이중 홈 인스턴스 생성

### 탄력적 IP 주소

- 인스턴스 또는 네트워크 인터페이스에 연결할 수 있습니다.
- 즉시 트래픽을 재연결하고 전송할 수 있습니다.
- AWS 리전당 5개가 허용됩니다.
- BYOIP(Bring Your Own IP)주소를 생성할 수 있습니다.

## 클라우드에서의 보안

### 보안그룹

- AWS 리소스에 대한 인바운드 및 아웃바운드 트래픽을 제어하는 가상 방화벽
- 모든 송,수신 트래픽은 모든 IP 프로토콜, 포트 또는 IP 주소로 제한될 수 있습니다.
- 규칙은 상태 저장입니다.

![https://s3-us-west-2.amazonaws.com/secure.notion-static.com/f15882dc-3ea9-499f-8488-0bd32ec5ca29/Untitled.png](https://s3-us-west-2.amazonaws.com/secure.notion-static.com/f15882dc-3ea9-499f-8488-0bd32ec5ca29/Untitled.png)

### 보안 그룹: 기본 설정

![https://s3-us-west-2.amazonaws.com/secure.notion-static.com/a446f171-1d91-481a-98c8-0bdf193221d8/Untitled.png](https://s3-us-west-2.amazonaws.com/secure.notion-static.com/a446f171-1d91-481a-98c8-0bdf193221d8/Untitled.png)

### 보안그룹: 트래픽 제어

대부분 조직은 각 기능 티어에 대한 인바운드 규칙으로 보안 그룹을 생성합니다.

### 보안그룹: 체인 다이어그램

![https://s3-us-west-2.amazonaws.com/secure.notion-static.com/bb3f9958-dbe4-4fce-881a-257160c96a35/Untitled.png](https://s3-us-west-2.amazonaws.com/secure.notion-static.com/bb3f9958-dbe4-4fce-881a-257160c96a35/Untitled.png)

![https://s3-us-west-2.amazonaws.com/secure.notion-static.com/3a6a7c5f-fb12-4652-b86f-985bfba324d5/Untitled.png](https://s3-us-west-2.amazonaws.com/secure.notion-static.com/3a6a7c5f-fb12-4652-b86f-985bfba324d5/Untitled.png)

외부 조건이 아니라 내부 조건으로만 접근 가능

### 네트워크 ACL(액세스 제어 목록)

- 서브넷 경계의 가상 방화벽
- 기본적으로 모든 인바운드 및 아웃바운드 트래픽을 허용합니다.
- 상태 비저장이므로 인바운드 및 아웃바운드 트래픽 모두에 대한 명시적인 규칙이 필요합니다.

![https://s3-us-west-2.amazonaws.com/secure.notion-static.com/8425cc84-202a-4442-964d-236ee1fe24b1/Untitled.png](https://s3-us-west-2.amazonaws.com/secure.notion-static.com/8425cc84-202a-4442-964d-236ee1fe24b1/Untitled.png)

## 검토

### 다중 보호 계층이 있는 인프라 구조

![https://s3-us-west-2.amazonaws.com/secure.notion-static.com/0794ae36-a6df-4e0e-945c-b72a145a60e4/Untitled.png](https://s3-us-west-2.amazonaws.com/secure.notion-static.com/0794ae36-a6df-4e0e-945c-b72a145a60e4/Untitled.png)

### VPC로 트래픽 보내기

VPC 서브넷의 인스턴스에 대해 인터넷 액세스를 활성화하려면 다음을 수행해야 합니다.

인터넷 게이트웨이를 VPC에 연결합니다.

라우팅 테이블을 인터넷 게이트웨이에 연결합니다.

인스턴스에 퍼블릭 IP 또는 탄력적인 IP주소가 있는지 확인합니다.

네트워크 ACL과 SG가 관련 트래픽 흐름을 허용하는지 확인합니다.

### 지식 확인

Q: VPC는 어디에 배포됩니까?

A: 리전

Q: 기본적으로 보안 그룹은 모든 수신 트래픽을 허용합니다. 원치 않는 트래픽을 차단하도록 규칙을 설정해야 합니다.

A: 거짓

VPC 피어링(CIDR이 겹치지 않게!)

# 실습

## 가상 사설 클라우트 생성

- Qwiklab 캡처

# AWS 기반 네트워킹 2부

### 고가용성

![https://s3-us-west-2.amazonaws.com/secure.notion-static.com/f924f88a-420d-40a8-b22c-883770c366b7/Untitled.png](https://s3-us-west-2.amazonaws.com/secure.notion-static.com/f924f88a-420d-40a8-b22c-883770c366b7/Untitled.png)

**아키텍처 측면에서의 필요성**

애플리케이션은 훨씬 더 큰(많은) 사용자 기반 및 변동 로드를 지원해야 하며 가용 영역 수준의 장애를 처리해야 합니다.

**모듈 개요**

- 네트워크 연결
- VPC 엔드포인트
- 로드 밸런싱
- 고가용성

## 네트워크 연결

```
VPC = 애플리케이션 단위의 격리 서비스
```

### 가상 프라이빗 게이트웨이(VGW)

Amazon VPC와 다른 네트워크 사이에 프라이빗 연결(VPN)을 설정할 수 있습니다.

### 온프레미스 네트워크를 AWS로 확장: VPN연결

![https://s3-us-west-2.amazonaws.com/secure.notion-static.com/59359f27-53ed-47db-be74-9115a89ca205/Untitled.png](https://s3-us-west-2.amazonaws.com/secure.notion-static.com/59359f27-53ed-47db-be74-9115a89ca205/Untitled.png)

CGW(Custom GateWay)

VGW(Virtual GateWay)

VPC 안에 Routing Table이 있어 서브넷 1로 갈지 서브넷2로 갈지 결정한다

### 온프레미스 네트워크를 AWS로 확장: 다수의 VPN

![https://s3-us-west-2.amazonaws.com/secure.notion-static.com/d69bdd6e-91cf-41aa-a3cf-b5cbc5d85f0e/Untitled.png](https://s3-us-west-2.amazonaws.com/secure.notion-static.com/d69bdd6e-91cf-41aa-a3cf-b5cbc5d85f0e/Untitled.png)

### AWS Direct Connect (DX)

AWS Direct Connect(DX)는 1 또는 10 Gbps의 전용 프라이빗 네트워크 연결을 제공합니다.

-미션 크리티컬하고 빠른 서비스 요구 시 사용

데이터 비용 감소, 예측 가능한 지표로 애플리케이션 성능 향상

### DX 사용 사례

- 하이브리드 클라우드 아키텍처
- 지속적인 대용량 데이터 세트 전송
- 네트워크 성능 예측 가능성
- 보안 및 규정 준수

### DX를 사용하여 온프레미스 네트워크를 AWS로 확장

![https://s3-us-west-2.amazonaws.com/secure.notion-static.com/26b72c86-625d-431c-bc66-51958bcc5bbd/Untitled.png](https://s3-us-west-2.amazonaws.com/secure.notion-static.com/26b72c86-625d-431c-bc66-51958bcc5bbd/Untitled.png)

### 크리티컬 워크로드를 위한 AWS Direct Connect 복원력

![https://s3-us-west-2.amazonaws.com/secure.notion-static.com/7083ec60-5be3-48c7-97ce-9c688795962e/Untitled.png](https://s3-us-west-2.amazonaws.com/secure.notion-static.com/7083ec60-5be3-48c7-97ce-9c688795962e/Untitled.png)

### VPC 연결

- 일반적으로 일부 워크로드를 격리하는 것이 좋습니다.
- 그러나 둘 이상의 VPC간에 데이터를 전송해야 할 수도 있습니다.

![https://s3-us-west-2.amazonaws.com/secure.notion-static.com/8c6c64d4-f20f-4873-905f-24b79397c012/Untitled.png](https://s3-us-west-2.amazonaws.com/secure.notion-static.com/8c6c64d4-f20f-4873-905f-24b79397c012/Untitled.png)

### VPC 연결 - VPC 피어링

![https://s3-us-west-2.amazonaws.com/secure.notion-static.com/d6ec97d5-17ca-41c0-9233-ef56b4e13240/Untitled.png](https://s3-us-west-2.amazonaws.com/secure.notion-static.com/d6ec97d5-17ca-41c0-9233-ef56b4e13240/Untitled.png)

- 프라이빗 IP 주소 사용
- 내부 및 리전 간 지원
- IP 공간은 중복될 수 없음
- 두 VPC간 하나의 피어링 리소스만 해당
- 전이적 피어링 관계는 지원되지 않음
- 서로 다른 AWS 계정 간에 설정 가능

### VPC 피어링

- 인터넷 게이트웨이 또는 가상 게이트웨이가 필요 없음
- 고가용성 연결, 단일 장애 지점 없음
- 대역폭 병목 현상 없음
- 트래픽은 항상 글로벌 AWS 백본에서 유지됨

![https://s3-us-west-2.amazonaws.com/secure.notion-static.com/695ef34c-c9c5-40ab-84d1-6d62502bb9e4/Untitled.png](https://s3-us-west-2.amazonaws.com/secure.notion-static.com/695ef34c-c9c5-40ab-84d1-6d62502bb9e4/Untitled.png)

### 여러 VPC 피어링

일반 모범 사례

다음과 같이 여러 VPC를 연결할 때 고려해야 할 몇 가지 범용 네트워크 설계 원칙이 있습니다.

중복되는 CIDR 블록 없음

필수 VPC만 연결

솔루션을 확장할 수 있어야 함

### VPC 연결 - Transit Gateway

단일 게이트웨이로 최대 5,000개의 VPC와 온프레미스 환경 연결

네트워크 사이를 이동하는 모든 트래픽의 허브 역할 담당

가용성이 뛰어나고 유연한 완전 관리형 라우팅 서비스

멀티캐스트 및 리전 간 피어링 허용

### Transit Gateway 실행

![https://s3-us-west-2.amazonaws.com/secure.notion-static.com/99486938-165e-4d4c-a512-c119d4d687fc/Untitled.png](https://s3-us-west-2.amazonaws.com/secure.notion-static.com/99486938-165e-4d4c-a512-c119d4d687fc/Untitled.png)

![https://s3-us-west-2.amazonaws.com/secure.notion-static.com/3ef3bde0-cd7f-4a35-b7b7-9b83f6465b9a/Untitled.png](https://s3-us-west-2.amazonaws.com/secure.notion-static.com/3ef3bde0-cd7f-4a35-b7b7-9b83f6465b9a/Untitled.png)

![https://s3-us-west-2.amazonaws.com/secure.notion-static.com/d4cfe951-604c-4935-b8b1-f4bd67eac347/Untitled.png](https://s3-us-west-2.amazonaws.com/secure.notion-static.com/d4cfe951-604c-4935-b8b1-f4bd67eac347/Untitled.png)

![https://s3-us-west-2.amazonaws.com/secure.notion-static.com/05331388-05a3-46f0-93e7-93127a4c36fd/Untitled.png](https://s3-us-west-2.amazonaws.com/secure.notion-static.com/05331388-05a3-46f0-93e7-93127a4c36fd/Untitled.png)

![https://s3-us-west-2.amazonaws.com/secure.notion-static.com/713c8ac6-f46a-49b7-93dd-ac56576f8505/Untitled.png](https://s3-us-west-2.amazonaws.com/secure.notion-static.com/713c8ac6-f46a-49b7-93dd-ac56576f8505/Untitled.png)

![https://s3-us-west-2.amazonaws.com/secure.notion-static.com/3003adcc-416b-4ccd-96a2-de5311524ca5/Untitled.png](https://s3-us-west-2.amazonaws.com/secure.notion-static.com/3003adcc-416b-4ccd-96a2-de5311524ca5/Untitled.png)

![https://s3-us-west-2.amazonaws.com/secure.notion-static.com/0bf5f091-1250-4780-b188-b294c66d5a2a/Untitled.png](https://s3-us-west-2.amazonaws.com/secure.notion-static.com/0bf5f091-1250-4780-b188-b294c66d5a2a/Untitled.png)

![https://s3-us-west-2.amazonaws.com/secure.notion-static.com/df2ca462-38cf-4b92-9350-8aea02770700/Untitled.png](https://s3-us-west-2.amazonaws.com/secure.notion-static.com/df2ca462-38cf-4b92-9350-8aea02770700/Untitled.png)

![https://s3-us-west-2.amazonaws.com/secure.notion-static.com/25137539-9b5e-4fae-881a-f8581b9a24e0/Untitled.png](https://s3-us-west-2.amazonaws.com/secure.notion-static.com/25137539-9b5e-4fae-881a-f8581b9a24e0/Untitled.png)

### 예: 공유 서비스용 VPC 피어링

![https://s3-us-west-2.amazonaws.com/secure.notion-static.com/79c55459-6b2c-4d1d-b5d5-400661a5daa2/Untitled.png](https://s3-us-west-2.amazonaws.com/secure.notion-static.com/79c55459-6b2c-4d1d-b5d5-400661a5daa2/Untitled.png)

(1) : transit gateway

(2) : vpc peering

(3) : vpn

### VPC 엔드포인트

AWS를 벗어나지 않고 EC2 인스턴스를 VPC 외부 서비스와 프라이빗하게 연결합니다.

인터넷 게이트웨이, VPN, NAT(Network Address Translation) 디바이스 또는 방화벽 프록시를 사용할 필요가 없습니다.

- 인터넷을 통해 통과할 필요가 없습니다.
- 동일한 리전에 있어야 합니다.
- 가용성이 뛰어나고, 중복적이며, 수평적으로 확장됩니다.

### VPC 외부에서부터 VPC 엔드포인트로 액세스하기

![https://s3-us-west-2.amazonaws.com/secure.notion-static.com/e1d1a9c6-1027-45eb-bd9d-63eb1cecb539/Untitled.png](https://s3-us-west-2.amazonaws.com/secure.notion-static.com/e1d1a9c6-1027-45eb-bd9d-63eb1cecb539/Untitled.png)

### VPC 인터페이스 엔드포인트(AWS PrivateLink)

![https://s3-us-west-2.amazonaws.com/secure.notion-static.com/561bb25d-d1dc-45f0-81b3-d64ca7dc07f9/Untitled.png](https://s3-us-west-2.amazonaws.com/secure.notion-static.com/561bb25d-d1dc-45f0-81b3-d64ca7dc07f9/Untitled.png)

## AWS 기반 로드 밸런싱

### Elastic Load Balancing(ELB)

수신되는 애플리케이션 트래픽을 여러 Amazon EC2 인스턴스, 컨테이너 및 IP 주소에 걸쳐 분산(서비스 부하분산)하는 관리형 로드 밸런싱 서비스

- HTTP,HTTPS,TCP,UDP 및 SSL(보안 TCP, UDP)프로토콜을 사용합니다.
- 외부 또는 내부에 위치할 수 있습니다.
- 각 로드밸런서에 DNS 이름(endpoint)이 부여됩니다.
- 비정상 인스턴스를 인식하고 이에 대응합니다.
    - Health check(heart beat) → 중단/장애 → 트래픽 중단

![https://s3-us-west-2.amazonaws.com/secure.notion-static.com/835dbe0d-9e41-4491-95cc-3504060a9568/Untitled.png](https://s3-us-west-2.amazonaws.com/secure.notion-static.com/835dbe0d-9e41-4491-95cc-3504060a9568/Untitled.png)

### ELB: 옵션

![https://s3-us-west-2.amazonaws.com/secure.notion-static.com/096e1480-b645-488d-8676-8227fe31e36e/Untitled.png](https://s3-us-west-2.amazonaws.com/secure.notion-static.com/096e1480-b645-488d-8676-8227fe31e36e/Untitled.png)

### ELB를 사용해야 하는 이유

고가용성, 상태 확인, 보안 기능, TLS 종료

### 등록 취소 지연

프로덕션 플릿에서 인스턴스를 제거해야 하지만 사용자에게 영향을 미치지 않으려는 경우:

![https://s3-us-west-2.amazonaws.com/secure.notion-static.com/d94fb4b2-cd14-4972-9988-5eb6c3c2a7db/Untitled.png](https://s3-us-west-2.amazonaws.com/secure.notion-static.com/d94fb4b2-cd14-4972-9988-5eb6c3c2a7db/Untitled.png)

### 클라우드 설계 패턴: Application Load Balancer

![https://s3-us-west-2.amazonaws.com/secure.notion-static.com/daadb343-1c7e-4cca-88ab-b27d2c87ed20/Untitled.png](https://s3-us-west-2.amazonaws.com/secure.notion-static.com/daadb343-1c7e-4cca-88ab-b27d2c87ed20/Untitled.png)

## 고가용성

### 고가용성이란?

애플리케이션은 허용되는 성능 저하 시간 내에 장애로부터 복구하거나 보조 소스로 이동할 수 있습니다.

**예제**

![https://s3-us-west-2.amazonaws.com/secure.notion-static.com/def785b9-d374-4a0b-acef-5a0c24b78007/Untitled.png](https://s3-us-west-2.amazonaws.com/secure.notion-static.com/def785b9-d374-4a0b-acef-5a0c24b78007/Untitled.png)

모든 기능은 장애가 발생한다는 가정하에 역방향으로 설계합니다.

가능한 모든 지점에서 중복성을 구현하여, 단일 장애로 인해 전체 시스템이 중단되지 않도록 합니다.

### 얼마나 많은 가용 영역을 사용해야 합니까?

AWS 리전당 2개의 가용 영역을 시작합니다.

한 가용 영역의 리소스에 접근할 수 없더라도 애플리케이션에 장애가 발생해서는 안됩니다.

## 다중 리전 고가용성 및 DNS

### Amazon Route 53

Route 53은 가용성과 확장성이 뛰어난 클라우드 Domain Name System(DNS)서비스 입니다.

- DNS는 도메인 이름을 IP 주소로 변환합니다.
- 도메인 이름을 구입하여 관리하고 DNS 설정을 자동으로 구성할 수 있습니다.
- AWS에서 유연한 고성능, 고가용성 아키텍처를 위한 도구를 제공합니다.
- 멀티플 라우팅 옵션

### Route 53 라우팅 옵션

간단한 라운드 로빈

가중치 기반 라운드 로빈

지연시간 기반 라우팅

상태확인 및 DNS 장애 조치

지리 위치 라우팅

트래픽 바이러스를 통한 지리 근접 라우팅

다중 값 응답

# 탄력성, 고가용성 및 모니터링

### 고가용성 요소

내결함성: 애플리케이션 구성 요소의 내장된 중복성

복구성: 재해 발생 후 서비스 복구와 관련된 프로세스, 정책 및 절차

확장성: 애플리케이션의 설계 변경 없이 성장을 수용하는 능력

## 기본 사항 이해

### 탄력성이 없는 경우 어떤 모습입니까?

일반적인 데이터 센터

리소스 비용을 선불로 결제하고 해당 리소스가 수요에 적합하길 바람

또는

너무 많은 추가 리소스, 비용 낭비, 전기 소모

### 탄력성이란?

탄력적인 인프라는 용량 요구사항이 변화함에 따라 지능적으로 확장 및 축소될 수 있습니다.

예:

- 트래픽 급증 시 웹 서버 수 증가
- 트래픽이 줄어들 때 데이터베이스의 쓰기 용량 감소
- 아키텍처 전반에 걸친 일상적인 수요 변동 처리

### 세 가지 유형의 탄력성

- 시간 기반

    리소스가 사용되지 않을 때 리소스 끄기(개발 및 테스트 환경)

- 볼륨 기반

    수요 강도에 맞게 규모 조정(충분한 컴퓨팅 파워가 있어야 함)

- 예측 기반

    일일 및 주간 추세를 기반으로 향후 트래픽 예측(정기적으로 발생하는 스파이크 포함)

## 모니터링

### 모니터링 이유

운영 상태, 리소스 활용, 애플리케이션 성능, 보안 감사

# 실습

## 고가용성 환경 생성

- 퀵랩 캡처
